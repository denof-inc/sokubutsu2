# staged filesã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆlint-stagedä½¿ç”¨ï¼‰
echo "ğŸ” Running pre-commit checks on staged files..."
npm run precommit || {
  echo "âŒ Pre-commit checks failed. Fix errors before committing."
  exit 1
}

# å‹ãƒã‚§ãƒƒã‚¯ï¼ˆè¿…é€Ÿï¼‰
echo "ğŸ” Typecheck (tsc --noEmit)"
npm run typecheck || {
  echo "âŒ Typecheck failed. Fix errors before committing."
  exit 1
}

# å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆå·®åˆ†ã«é–¢é€£ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å„ªå…ˆå®Ÿè¡Œã€‚è©²å½“ãªã—ãªã‚‰å…¨ä»¶ï¼‰
echo "ğŸ§ª Running unit tests..."
STAGED=$(git diff --name-only --cached | tr '\n' ' ')
if [ -n "$STAGED" ]; then
  npx jest --bail --findRelatedTests $STAGED || {
    echo "âŒ Related tests failed. Fix failing tests before committing."
    exit 1
  }
else
  npm run test || {
    echo "âŒ Tests failed. Fix failing tests before committing."
    exit 1
  }
fi

echo "âœ… All checks passed!"
