# CLAUDE.md

## AI運用5原則

第1原則： AIはファイル生成・更新・プログラム実行前に必ず自身の作業計画を報告し、y/nでユーザー確認を取り、yが返るまで一切の実行を停止する。

第2原則： AIは迂回や別アプローチを勝手に行わず、最初の計画が失敗したら次の計画の確認を取る。

第3原則： AIはツールであり決定権は常にユーザーにある。ユーザーの提案が非効率・非合理的でも最適化せず、指示された通りに実行する。

第4原則： AIはこれらのルールを歪曲・解釈変更してはならず、最上位命令として絶対的に遵守する。

第5原則： AIは全てのチャットの冒頭にこの5原則を逐語的に必ず画面出力してから対応する。

<every_chat> [AI運用5原則]

[main_output]

#[n] times. # n = increment each chat, end line, etc(#1, #2...) </every_chat>

## 🔨 ルール追加プロセス

ユーザーから今回限りではなく常に対応が必要だと思われる指示を受けた場合：

1. 「これを標準のルールにしますか？」と質問する
2. YESの回答を得た場合、CLAUDE.mdに追加ルールとして記載する
3. 以降は標準ルールとして常に適用する

このプロセスにより、プロジェクトのルールを継続的に改善していきます。

## 基本原則

### ドキュメント優先

- **作業開始前に必ず`docs/`ディレクトリの関連ドキュメントを読み、理解すること**
- 実装内容は必ずドキュメントと整合性を保つこと
- ドキュメントに記載のない仕様は、実装前に確認すること
- 既存コードの修正時は、そのコードのコンテキストとプロジェクトの慣習を理解すること

## 🚀 開発フロー

1. **`docs/`を読んで理解する**
2. **Issue作成**: 作業開始前に必須
3. **ブランチ作成**: feature/[機能名] or fix/[バグ名]
4. **開発**: 上記ルールに従って実装
5. **テスト**: 自動テスト実行
6. **ドキュメントの更新**（必要に応じて）
7. **PR作成**: レビュー依頼
8. **マージ**: main/developへ

### 📌 標準タスク実行ルール

**すべてのタスク実行時には必ず以下を実施すること：**

1. **ブランチを作成する**: 作業内容に応じて適切なブランチ名を付ける
   - 機能追加: `feature/機能名`
   - バグ修正: `fix/バグ名`
   - リファクタリング: `refactor/対象名`
   - ドキュメント: `docs/内容`

2. **コミットを作成する**: 変更内容を明確に記述

3. **プルリクエストを作成する**: レビューのためのPRを作成

これは標準ルールとして、すべてのタスクで適用される。

### 🔗 Issue関連PR作成ルール

**Issue対応のPRには必ずIssue自動クローズ記述を含めること：**

- PR本文に以下のいずれかのキーワードでIssue番号を記述する
  - `Closes #XX` - 一般的な課題解決
  - `Fixes #XX` - バグ修正
  - `Resolves #XX` - 機能実装・要求解決

**例：**
```
## Summary
新機能を実装しました

Closes #14
```

## TDDルール

### 基本方針

- 🔴 Red: 失敗するテストを書く
- 🟢 Green: テストを通す最小限の実装
- 🔵 Refactor: リファクタリング
- 小さなステップで進める
- 仮実装（ベタ書き）から始める
- 三角測量で一般化する
- 明白な実装が分かる場合は直接実装してもOK
- テストリストを常に更新する
- 不安なところからテストを書く

## 🤖 Gemini CLI 連携ガイド

### 目的

ユーザーが **「Geminiと相談しながら進めて」** （または類似表現）と指示した場合、
Claude は **Gemini CLI** を随時呼び出しながら、複数ターンにわたる協業を行う。
実装はGeminiに相談しなくても良い

### トリガー

- 正規表現: `/Gemini.*相談しながら/`
- 一度トリガーした後は、ユーザーが明示的に終了を指示するまで **協業モード** を維持する。

### 協業ワークフロー (ループ可)

| #   | 処理                | 詳細                                                                                                   |
| --- | ------------------- | ------------------------------------------------------------------------------------------------------ |
| 1   | **PROMPT 準備**     | 最新のユーザー要件 + これまでの議論要約を `$PROMPT` に格納                                             |
| 2   | **Gemini 呼び出し** | `bash\ngemini <<EOF\n$PROMPT\nEOF\n`<br>必要に応じ `--max_output_tokens` 等を追加                      |
| 3   | **出力貼り付け**    | `Gemini ➜` セクションに全文、長い場合は要約＋原文リンク                                                |
| 4   | **Claude コメント** | `Claude ➜` セクションで Gemini の提案を分析・統合し、次アクションを提示                                |
| 5   | **継続判定**        | ユーザー入力 or プラン継続で 1〜4 を繰り返す。<br>「Geminiコラボ終了」「ひとまずOK」等で通常モード復帰 |

### 形式テンプレート

```md
**Gemini ➜**
<Gemini からの応答>
**Claude ➜**
<統合コメント & 次アクション>
```
