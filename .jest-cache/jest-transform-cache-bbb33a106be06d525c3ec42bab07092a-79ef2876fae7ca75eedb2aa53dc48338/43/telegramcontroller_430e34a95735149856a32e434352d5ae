595e2fad856561d949eb9ebfe1e0695e
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var TelegramController_1;
Object.defineProperty(exports, "__esModule", { value: true });
exports.TelegramController = void 0;
const common_1 = require("@nestjs/common");
const guards_1 = require("../../common/guards");
const telegram_user_decorator_1 = require("../../core/auth/decorators/telegram-user.decorator");
const user_entity_1 = require("../users/entities/user.entity");
const auth_service_1 = require("../../core/auth/auth.service");
const telegram_service_1 = require("./telegram.service");
let TelegramController = TelegramController_1 = class TelegramController {
    authService;
    telegramService;
    logger = new common_1.Logger(TelegramController_1.name);
    constructor(authService, telegramService) {
        this.authService = authService;
        this.telegramService = telegramService;
    }
    /**
     * Telegram Webhook „Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà
     */
    async handleUpdate(update, user, telegramUser, isNewUser) {
        this.logger.debug(`Received update: ${String(JSON.stringify(update))}`);
        // „É°„ÉÉ„Çª„Éº„Ç∏„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
        if (!update.message || !update.message.text) {
            return { ok: true };
        }
        const chatId = update.message.chat.id;
        const text = update.message.text;
        // „Ç≥„Éû„É≥„Éâ„ÅÆËß£Êûê
        const command = this.parseCommand(text);
        try {
            switch (command.name) {
                case '/start':
                    await this.handleStartCommand(chatId, telegramUser, isNewUser);
                    break;
                case '/add':
                    await this.handleAddCommand(chatId, user, command.args);
                    break;
                case '/list':
                    await this.handleListCommand(chatId, user);
                    break;
                case '/remove':
                    await this.handleRemoveCommand(chatId, user, command.args);
                    break;
                case '/pause':
                    await this.handlePauseCommand(chatId, user, command.args);
                    break;
                case '/resume':
                    await this.handleResumeCommand(chatId, user, command.args);
                    break;
                case '/status':
                    await this.handleStatusCommand(chatId, user);
                    break;
                case '/help':
                    await this.handleHelpCommand(chatId);
                    break;
                default:
                    await this.telegramService.sendMessage(chatId, '‰∏çÊòé„Å™„Ç≥„Éû„É≥„Éâ„Åß„Åô„ÄÇ/help „Åß„Ç≥„Éû„É≥„Éâ‰∏ÄË¶ß„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        }
        catch (error) {
            this.logger.error(`Command execution error:`, error);
            await this.telegramService.sendMessage(chatId, '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„ÅèÂæÖ„Å£„Å¶„Åã„ÇâÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }
        return { ok: true };
    }
    /**
     * /start „Ç≥„Éû„É≥„Éâ„Éè„É≥„Éâ„É©„Éº
     */
    async handleStartCommand(chatId, telegramUser, _isNewUser) {
        const result = await this.authService.handleStartCommand(telegramUser);
        await this.telegramService.sendMessage(chatId, result.welcomeMessage);
    }
    /**
     * /add „Ç≥„Éû„É≥„Éâ„Éè„É≥„Éâ„É©„Éº
     */
    async handleAddCommand(chatId, user, args) {
        if (args.length === 0) {
            await this.telegramService.sendMessage(chatId, '‰ΩøÁî®ÊñπÊ≥ï: /add <URL>\n‰æã: /add https://www.example.com/property/123');
            return;
        }
        const url = args[0];
        // URLÊ§úË®º
        if (!this.isValidUrl(url)) {
            await this.telegramService.sendMessage(chatId, 'ÊúâÂäπ„Å™URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return;
        }
        // TODO: URLËøΩÂä†Âá¶ÁêÜ„ÇíÂÆüË£Ö
        await this.telegramService.sendMessage(chatId, `URL "${url}" „ÇíÁõ£Ë¶ñ„É™„Çπ„Éà„Å´ËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ\nÊñ∞ÁùÄÁâ©‰ª∂„ÅåË¶ã„Å§„Åã„ÇäÊ¨°Á¨¨„ÅäÁü•„Çâ„Åõ„Åó„Åæ„Åô„ÄÇ`);
    }
    /**
     * /list „Ç≥„Éû„É≥„Éâ„Éè„É≥„Éâ„É©„Éº
     */
    async handleListCommand(chatId, _user) {
        // TODO: „É¶„Éº„Ç∂„Éº„ÅÆÁõ£Ë¶ñURL‰∏ÄË¶ß„ÇíÂèñÂæó
        const message = `
üìã Áõ£Ë¶ñ‰∏≠„ÅÆURL‰∏ÄË¶ß:

1. https://example.com/property/123
   Áä∂ÊÖã: üü¢ Áõ£Ë¶ñ‰∏≠
   ÊúÄÁµÇ„ÉÅ„Çß„ÉÉ„ÇØ: 5ÂàÜÂâç

2. https://example.com/property/456
   Áä∂ÊÖã: ‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠
   ÊúÄÁµÇ„ÉÅ„Çß„ÉÉ„ÇØ: 1ÊôÇÈñìÂâç

ÁôªÈå≤Êï∞: 2‰ª∂
    `.trim();
        await this.telegramService.sendMessage(chatId, message);
    }
    /**
     * /remove „Ç≥„Éû„É≥„Éâ„Éè„É≥„Éâ„É©„Éº
     */
    async handleRemoveCommand(chatId, user, args) {
        if (args.length === 0) {
            await this.telegramService.sendMessage(chatId, '‰ΩøÁî®ÊñπÊ≥ï: /remove <Áï™Âè∑>\n/list „ÅßÁï™Âè∑„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return;
        }
        const index = parseInt(args[0]);
        if (isNaN(index)) {
            await this.telegramService.sendMessage(chatId, 'Áï™Âè∑„ÇíÊ≠£„Åó„ÅèÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return;
        }
        // TODO: URLÂâäÈô§Âá¶ÁêÜ„ÇíÂÆüË£Ö
        await this.telegramService.sendMessage(chatId, `Áï™Âè∑ ${String(index)} „ÅÆURL„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ`);
    }
    /**
     * /pause „Ç≥„Éû„É≥„Éâ„Éè„É≥„Éâ„É©„Éº
     */
    async handlePauseCommand(chatId, user, args) {
        if (args.length === 0) {
            await this.telegramService.sendMessage(chatId, '‰ΩøÁî®ÊñπÊ≥ï: /pause <Áï™Âè∑>\n/list „ÅßÁï™Âè∑„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return;
        }
        const index = parseInt(args[0]);
        if (isNaN(index)) {
            await this.telegramService.sendMessage(chatId, 'Áï™Âè∑„ÇíÊ≠£„Åó„ÅèÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return;
        }
        // TODO: Áõ£Ë¶ñ‰∏ÄÊôÇÂÅúÊ≠¢Âá¶ÁêÜ„ÇíÂÆüË£Ö
        await this.telegramService.sendMessage(chatId, `Áï™Âè∑ ${String(index)} „ÅÆÁõ£Ë¶ñ„Çí‰∏ÄÊôÇÂÅúÊ≠¢„Åó„Åæ„Åó„Åü„ÄÇ`);
    }
    /**
     * /resume „Ç≥„Éû„É≥„Éâ„Éè„É≥„Éâ„É©„Éº
     */
    async handleResumeCommand(chatId, user, args) {
        if (args.length === 0) {
            await this.telegramService.sendMessage(chatId, '‰ΩøÁî®ÊñπÊ≥ï: /resume <Áï™Âè∑>\n/list „ÅßÁï™Âè∑„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return;
        }
        const index = parseInt(args[0]);
        if (isNaN(index)) {
            await this.telegramService.sendMessage(chatId, 'Áï™Âè∑„ÇíÊ≠£„Åó„ÅèÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return;
        }
        // TODO: Áõ£Ë¶ñÂÜçÈñãÂá¶ÁêÜ„ÇíÂÆüË£Ö
        await this.telegramService.sendMessage(chatId, `Áï™Âè∑ ${String(index)} „ÅÆÁõ£Ë¶ñ„ÇíÂÜçÈñã„Åó„Åæ„Åó„Åü„ÄÇ`);
    }
    /**
     * /status „Ç≥„Éû„É≥„Éâ„Éè„É≥„Éâ„É©„Éº
     */
    async handleStatusCommand(chatId, user) {
        // TODO: „É¶„Éº„Ç∂„Éº„ÅÆÁõ£Ë¶ñÁä∂Ê≥Å„ÇíÂèñÂæó
        const message = `
üìä Áõ£Ë¶ñÁä∂Ê≥Å:

üë§ „É¶„Éº„Ç∂„Éº: ${user.fullName}
üìÖ ÁôªÈå≤Êó•: ${user.createdAt.toLocaleDateString('ja-JP')}
üîç Áõ£Ë¶ñ‰∏≠URL: 2‰ª∂
‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠: 1‰ª∂
üîî ÈÄöÁü•Ë®≠ÂÆö: ${user.settings?.notifications.enabled ? 'ON' : 'OFF'}

ÊúÄÁµÇ„ÉÅ„Çß„ÉÉ„ÇØ: 5ÂàÜÂâç
Ê¨°Âõû„ÉÅ„Çß„ÉÉ„ÇØ: 10ÂàÜÂæå
    `.trim();
        await this.telegramService.sendMessage(chatId, message);
    }
    /**
     * /help „Ç≥„Éû„É≥„Éâ„Éè„É≥„Éâ„É©„Éº
     */
    async handleHelpCommand(chatId) {
        const message = `
üìö „Ç≥„Éû„É≥„Éâ‰∏ÄË¶ß:

/start - „Éú„ÉÉ„Éà„ÇíÈñãÂßã
/add <URL> - Áõ£Ë¶ñURL„ÇíËøΩÂä†
/list - ÁôªÈå≤URL‰∏ÄË¶ß„ÇíË°®Á§∫
/remove <Áï™Âè∑> - URL„ÇíÂâäÈô§
/pause <Áï™Âè∑> - Áõ£Ë¶ñ„Çí‰∏ÄÊôÇÂÅúÊ≠¢
/resume <Áï™Âè∑> - Áõ£Ë¶ñ„ÇíÂÜçÈñã
/status - Áõ£Ë¶ñÁä∂Ê≥Å„ÇíÁ¢∫Ë™ç
/help - „Åì„ÅÆ„Éò„É´„Éó„ÇíË°®Á§∫

‚ùì ‰Ωø„ÅÑÊñπ:
1. /add „ÅßURL„ÇíÁôªÈå≤
2. Êñ∞ÁùÄÁâ©‰ª∂„Åå„ÅÇ„Çå„Å∞Ëá™ÂãïÈÄöÁü•
3. /list „ÅßÁôªÈå≤Áä∂Ê≥Å„ÇíÁ¢∫Ë™ç

„ÅäÂõ∞„Çä„ÅÆÂ†¥Âêà„ÅØ @sokubutsu_support „Åæ„Åß„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ
    `.trim();
        await this.telegramService.sendMessage(chatId, message);
    }
    /**
     * „Ç≥„Éû„É≥„Éâ„Çí„Éë„Éº„Çπ
     */
    parseCommand(text) {
        const parts = text.trim().split(/\s+/);
        const name = parts[0].toLowerCase();
        const args = parts.slice(1);
        return { name, args };
    }
    /**
     * URLÊ§úË®º
     */
    isValidUrl(url) {
        try {
            new URL(url);
            return true;
        }
        catch {
            return false;
        }
    }
};
exports.TelegramController = TelegramController;
__decorate([
    (0, common_1.Post)('webhook'),
    (0, common_1.UseGuards)(guards_1.TelegramWebhookGuard, guards_1.TelegramAuthGuard, guards_1.RateLimitGuard),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, telegram_user_decorator_1.CurrentUser)()),
    __param(2, (0, telegram_user_decorator_1.TelegramUser)()),
    __param(3, (0, telegram_user_decorator_1.IsNewUser)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, user_entity_1.User, Object, Boolean]),
    __metadata("design:returntype", Promise)
], TelegramController.prototype, "handleUpdate", null);
exports.TelegramController = TelegramController = TelegramController_1 = __decorate([
    (0, common_1.Controller)('telegram'),
    __metadata("design:paramtypes", [auth_service_1.AuthService,
        telegram_service_1.TelegramService])
], TelegramController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3R0dGVsYS9Eb2N1bWVudHMvV29yay9kZW5vZi93b3Jrcy8yNTA1Mjlzb2t1YnV0c3UvZGV2Mi9zcmMvZG9tYWluL3RlbGVncmFtL3RlbGVncmFtLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUEyRTtBQUMzRSxnREFJNkI7QUFDN0IsZ0dBSTREO0FBQzVELCtEQUFxRDtBQUtyRCwrREFBMkQ7QUFDM0QseURBQXFEO0FBRzlDLElBQU0sa0JBQWtCLDBCQUF4QixNQUFNLGtCQUFrQjtJQUlWO0lBQ0E7SUFKRixNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsb0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFOUQsWUFDbUIsV0FBd0IsRUFDeEIsZUFBZ0M7UUFEaEMsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDeEIsb0JBQWUsR0FBZixlQUFlLENBQWlCO0lBQ2hELENBQUM7SUFFSjs7T0FFRztJQUdHLEFBQU4sS0FBSyxDQUFDLFlBQVksQ0FDUixNQUFzQixFQUNmLElBQVUsRUFDVCxZQUEyQixFQUM5QixTQUFrQjtRQUUvQixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFeEUsZ0JBQWdCO1FBQ2hCLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUM1QyxPQUFPLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDO1FBQ3RCLENBQUM7UUFFRCxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDdEMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7UUFFakMsVUFBVTtRQUNWLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxZQUFZ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UUFDZCxDQUFDO1FBQUMsTUFBTSxDQUFDO1lBQ1AsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUE7QUFyVFksZ0RBQWtCO0FBYXZCO0lBRkwsSUFBQSxhQUFJLEVBQUMsU0FBUyxDQUFDO0lBQ2YsSUFBQSxrQkFBUyxFQUFDLDZCQUFvQixFQUFFLDBCQUFpQixFQUFFLHVCQUFjLENBQUM7SUFFaEUsV0FBQSxJQUFBLGFBQUksR0FBRSxDQUFBO0lBQ04sV0FBQSxJQUFBLHFDQUFXLEdBQUUsQ0FBQTtJQUNiLFdBQUEsSUFBQSxzQ0FBWSxHQUFFLENBQUE7SUFDZCxXQUFBLElBQUEsbUNBQVMsR0FBRSxDQUFBOzs2Q0FGUyxrQkFBSTs7c0RBa0UxQjs2QkFqRlUsa0JBQWtCO0lBRDlCLElBQUEsbUJBQVUsRUFBQyxVQUFVLENBQUM7cUNBS1csMEJBQVc7UUFDUCxrQ0FBZTtHQUx4QyxrQkFBa0IsQ0FxVDlCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy90dHRlbGEvRG9jdW1lbnRzL1dvcmsvZGVub2Yvd29ya3MvMjUwNTI5c29rdWJ1dHN1L2RldjIvc3JjL2RvbWFpbi90ZWxlZ3JhbS90ZWxlZ3JhbS5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnRyb2xsZXIsIFBvc3QsIEJvZHksIFVzZUd1YXJkcywgTG9nZ2VyIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHtcbiAgVGVsZWdyYW1BdXRoR3VhcmQsXG4gIFRlbGVncmFtV2ViaG9va0d1YXJkLFxuICBSYXRlTGltaXRHdWFyZCxcbn0gZnJvbSAnLi4vLi4vY29tbW9uL2d1YXJkcyc7XG5pbXBvcnQge1xuICBDdXJyZW50VXNlcixcbiAgVGVsZWdyYW1Vc2VyLFxuICBJc05ld1VzZXIsXG59IGZyb20gJy4uLy4uL2NvcmUvYXV0aC9kZWNvcmF0b3JzL3RlbGVncmFtLXVzZXIuZGVjb3JhdG9yJztcbmltcG9ydCB7IFVzZXIgfSBmcm9tICcuLi91c2Vycy9lbnRpdGllcy91c2VyLmVudGl0eSc7XG5pbXBvcnQge1xuICBUZWxlZ3JhbVVwZGF0ZSxcbiAgVGVsZWdyYW1Vc2VyIGFzIElUZWxlZ3JhbVVzZXIsXG59IGZyb20gJy4uLy4uL2NvbW1vbi9pbnRlcmZhY2VzJztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9hdXRoL2F1dGguc2VydmljZSc7XG5pbXBvcnQgeyBUZWxlZ3JhbVNlcnZpY2UgfSBmcm9tICcuL3RlbGVncmFtLnNlcnZpY2UnO1xuXG5AQ29udHJvbGxlcigndGVsZWdyYW0nKVxuZXhwb3J0IGNsYXNzIFRlbGVncmFtQ29udHJvbGxlciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihUZWxlZ3JhbUNvbnRyb2xsZXIubmFtZSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBhdXRoU2VydmljZTogQXV0aFNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSB0ZWxlZ3JhbVNlcnZpY2U6IFRlbGVncmFtU2VydmljZSxcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBUZWxlZ3JhbSBXZWJob29rIOOCqOODs+ODieODneOCpOODs+ODiFxuICAgKi9cbiAgQFBvc3QoJ3dlYmhvb2snKVxuICBAVXNlR3VhcmRzKFRlbGVncmFtV2ViaG9va0d1YXJkLCBUZWxlZ3JhbUF1dGhHdWFyZCwgUmF0ZUxpbWl0R3VhcmQpXG4gIGFzeW5jIGhhbmRsZVVwZGF0ZShcbiAgICBAQm9keSgpIHVwZGF0ZTogVGVsZWdyYW1VcGRhdGUsXG4gICAgQEN1cnJlbnRVc2VyKCkgdXNlcjogVXNlcixcbiAgICBAVGVsZWdyYW1Vc2VyKCkgdGVsZWdyYW1Vc2VyOiBJVGVsZWdyYW1Vc2VyLFxuICAgIEBJc05ld1VzZXIoKSBpc05ld1VzZXI6IGJvb2xlYW4sXG4gICkge1xuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBSZWNlaXZlZCB1cGRhdGU6ICR7U3RyaW5nKEpTT04uc3RyaW5naWZ5KHVwZGF0ZSkpfWApO1xuXG4gICAgLy8g44Oh44OD44K744O844K444GM44Gq44GE5aC05ZCI44Gv54Sh6KaWXG4gICAgaWYgKCF1cGRhdGUubWVzc2FnZSB8fCAhdXBkYXRlLm1lc3NhZ2UudGV4dCkge1xuICAgICAgcmV0dXJuIHsgb2s6IHRydWUgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjaGF0SWQgPSB1cGRhdGUubWVzc2FnZS5jaGF0LmlkO1xuICAgIGNvbnN0IHRleHQgPSB1cGRhdGUubWVzc2FnZS50ZXh0O1xuXG4gICAgLy8g44Kz44Oe44Oz44OJ44Gu6Kej5p6QXG4gICAgY29uc3QgY29tbWFuZCA9IHRoaXMucGFyc2VDb21tYW5kKHRleHQpO1xuXG4gICAgdHJ5IHtcbiAgICAgIHN3aXRjaCAoY29tbWFuZC5uYW1lKSB7XG4gICAgICAgIGNhc2UgJy9zdGFydCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVTdGFydENvbW1hbmQoY2hhdElkLCB0ZWxlZ3JhbVVzZXIsIGlzTmV3VXNlcik7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnL2FkZCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVBZGRDb21tYW5kKGNoYXRJZCwgdXNlciwgY29tbWFuZC5hcmdzKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICcvbGlzdCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVMaXN0Q29tbWFuZChjaGF0SWQsIHVzZXIpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJy9yZW1vdmUnOlxuICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlUmVtb3ZlQ29tbWFuZChjaGF0SWQsIHVzZXIsIGNvbW1hbmQuYXJncyk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnL3BhdXNlJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZVBhdXNlQ29tbWFuZChjaGF0SWQsIHVzZXIsIGNvbW1hbmQuYXJncyk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnL3Jlc3VtZSc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVSZXN1bWVDb21tYW5kKGNoYXRJZCwgdXNlciwgY29tbWFuZC5hcmdzKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICcvc3RhdHVzJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZVN0YXR1c0NvbW1hbmQoY2hhdElkLCB1c2VyKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICcvaGVscCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVIZWxwQ29tbWFuZChjaGF0SWQpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgYXdhaXQgdGhpcy50ZWxlZ3JhbVNlcnZpY2Uuc2VuZE1lc3NhZ2UoXG4gICAgICAgICAgICBjaGF0SWQsXG4gICAgICAgICAgICAn5LiN5piO44Gq44Kz44Oe44Oz44OJ44Gn44GZ44CCL2hlbHAg44Gn44Kz44Oe44Oz44OJ5LiA6Kan44KS56K66KqN44GX44Gm44GP44Gg44GV44GE44CCJyxcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgQ29tbWFuZCBleGVjdXRpb24gZXJyb3I6YCwgZXJyb3IpO1xuICAgICAgYXdhaXQgdGhpcy50ZWxlZ3JhbVNlcnZpY2Uuc2VuZE1lc3NhZ2UoXG4gICAgICAgIGNoYXRJZCxcbiAgICAgICAgJ+OCqOODqeODvOOBjOeZuueUn+OBl+OBvuOBl+OBn+OAguOBl+OBsOOCieOBj+W+heOBo+OBpuOBi+OCieWGjeW6puOBiuippuOBl+OBj+OBoOOBleOBhOOAgicsXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB7IG9rOiB0cnVlIH07XG4gIH1cblxuICAvKipcbiAgICogL3N0YXJ0IOOCs+ODnuODs+ODieODj+ODs+ODieODqeODvFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTdGFydENvbW1hbmQoXG4gICAgY2hhdElkOiBudW1iZXIsXG4gICAgdGVsZWdyYW1Vc2VyOiBJVGVsZWdyYW1Vc2VyLFxuICAgIF9pc05ld1VzZXI6IGJvb2xlYW4sXG4gICkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UuaGFuZGxlU3RhcnRDb21tYW5kKHRlbGVncmFtVXNlcik7XG4gICAgYXdhaXQgdGhpcy50ZWxlZ3JhbVNlcnZpY2Uuc2VuZE1lc3NhZ2UoY2hhdElkLCByZXN1bHQud2VsY29tZU1lc3NhZ2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIC9hZGQg44Kz44Oe44Oz44OJ44OP44Oz44OJ44Op44O8XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGhhbmRsZUFkZENvbW1hbmQoY2hhdElkOiBudW1iZXIsIHVzZXI6IFVzZXIsIGFyZ3M6IHN0cmluZ1tdKSB7XG4gICAgaWYgKGFyZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICBhd2FpdCB0aGlzLnRlbGVncmFtU2VydmljZS5zZW5kTWVzc2FnZShcbiAgICAgICAgY2hhdElkLFxuICAgICAgICAn5L2/55So5pa55rOVOiAvYWRkIDxVUkw+XFxu5L6LOiAvYWRkIGh0dHBzOi8vd3d3LmV4YW1wbGUuY29tL3Byb3BlcnR5LzEyMycsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHVybCA9IGFyZ3NbMF07XG5cbiAgICAvLyBVUkzmpJzoqLxcbiAgICBpZiAoIXRoaXMuaXNWYWxpZFVybCh1cmwpKSB7XG4gICAgICBhd2FpdCB0aGlzLnRlbGVncmFtU2VydmljZS5zZW5kTWVzc2FnZShcbiAgICAgICAgY2hhdElkLFxuICAgICAgICAn5pyJ5Yq544GqVVJM44KS5YWl5Yqb44GX44Gm44GP44Gg44GV44GE44CCJyxcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVE9ETzogVVJM6L+95Yqg5Yem55CG44KS5a6f6KOFXG4gICAgYXdhaXQgdGhpcy50ZWxlZ3JhbVNlcnZpY2Uuc2VuZE1lc3NhZ2UoXG4gICAgICBjaGF0SWQsXG4gICAgICBgVVJMIFwiJHt1cmx9XCIg44KS55uj6KaW44Oq44K544OI44Gr6L+95Yqg44GX44G+44GX44Gf77yBXFxu5paw552A54mp5Lu244GM6KaL44Gk44GL44KK5qyh56ys44GK55+l44KJ44Gb44GX44G+44GZ44CCYCxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIC9saXN0IOOCs+ODnuODs+ODieODj+ODs+ODieODqeODvFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVMaXN0Q29tbWFuZChjaGF0SWQ6IG51bWJlciwgX3VzZXI6IFVzZXIpIHtcbiAgICAvLyBUT0RPOiDjg6bjg7zjgrbjg7zjga7nm6PoppZVUkzkuIDopqfjgpLlj5blvpdcbiAgICBjb25zdCBtZXNzYWdlID0gYFxu8J+TiyDnm6PoppbkuK3jga5VUkzkuIDopqc6XG5cbjEuIGh0dHBzOi8vZXhhbXBsZS5jb20vcHJvcGVydHkvMTIzXG4gICDnirbmhYs6IPCfn6Ig55uj6KaW5LitXG4gICDmnIDntYLjg4Hjgqfjg4Pjgq86IDXliIbliY1cblxuMi4gaHR0cHM6Ly9leGFtcGxlLmNvbS9wcm9wZXJ0eS80NTZcbiAgIOeKtuaFizog4o+477iPIOS4gOaZguWBnOatouS4rVxuICAg5pyA57WC44OB44Kn44OD44KvOiAx5pmC6ZaT5YmNXG5cbueZu+mMsuaVsDogMuS7tlxuICAgIGAudHJpbSgpO1xuXG4gICAgYXdhaXQgdGhpcy50ZWxlZ3JhbVNlcnZpY2Uuc2VuZE1lc3NhZ2UoY2hhdElkLCBtZXNzYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiAvcmVtb3ZlIOOCs+ODnuODs+ODieODj+ODs+ODieODqeODvFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVSZW1vdmVDb21tYW5kKFxuICAgIGNoYXRJZDogbnVtYmVyLFxuICAgIHVzZXI6IFVzZXIsXG4gICAgYXJnczogc3RyaW5nW10sXG4gICkge1xuICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgYXdhaXQgdGhpcy50ZWxlZ3JhbVNlcnZpY2Uuc2VuZE1lc3NhZ2UoXG4gICAgICAgIGNoYXRJZCxcbiAgICAgICAgJ+S9v+eUqOaWueazlTogL3JlbW92ZSA855Wq5Y+3Plxcbi9saXN0IOOBp+eVquWPt+OCkueiuuiqjeOBl+OBpuOBj+OBoOOBleOBhOOAgicsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoYXJnc1swXSk7XG4gICAgaWYgKGlzTmFOKGluZGV4KSkge1xuICAgICAgYXdhaXQgdGhpcy50ZWxlZ3JhbVNlcnZpY2Uuc2VuZE1lc3NhZ2UoXG4gICAgICAgIGNoYXRJZCxcbiAgICAgICAgJ+eVquWPt+OCkuato+OBl+OBj+WFpeWKm+OBl+OBpuOBj+OBoOOBleOBhOOAgicsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRPRE86IFVSTOWJiumZpOWHpueQhuOCkuWun+ijhVxuICAgIGF3YWl0IHRoaXMudGVsZWdyYW1TZXJ2aWNlLnNlbmRNZXNzYWdlKFxuICAgICAgY2hhdElkLFxuICAgICAgYOeVquWPtyAke1N0cmluZyhpbmRleCl9IOOBrlVSTOOCkuWJiumZpOOBl+OBvuOBl+OBn+OAgmAsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiAvcGF1c2Ug44Kz44Oe44Oz44OJ44OP44Oz44OJ44Op44O8XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGhhbmRsZVBhdXNlQ29tbWFuZChjaGF0SWQ6IG51bWJlciwgdXNlcjogVXNlciwgYXJnczogc3RyaW5nW10pIHtcbiAgICBpZiAoYXJncy5sZW5ndGggPT09IDApIHtcbiAgICAgIGF3YWl0IHRoaXMudGVsZWdyYW1TZXJ2aWNlLnNlbmRNZXNzYWdlKFxuICAgICAgICBjaGF0SWQsXG4gICAgICAgICfkvb/nlKjmlrnms5U6IC9wYXVzZSA855Wq5Y+3Plxcbi9saXN0IOOBp+eVquWPt+OCkueiuuiqjeOBl+OBpuOBj+OBoOOBleOBhOOAgicsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoYXJnc1swXSk7XG4gICAgaWYgKGlzTmFOKGluZGV4KSkge1xuICAgICAgYXdhaXQgdGhpcy50ZWxlZ3JhbVNlcnZpY2Uuc2VuZE1lc3NhZ2UoXG4gICAgICAgIGNoYXRJZCxcbiAgICAgICAgJ+eVquWPt+OCkuato+OBl+OBj+WFpeWKm+OBl+OBpuOBj+OBoOOBleOBhOOAgicsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRPRE86IOebo+imluS4gOaZguWBnOatouWHpueQhuOCkuWun+ijhVxuICAgIGF3YWl0IHRoaXMudGVsZWdyYW1TZXJ2aWNlLnNlbmRNZXNzYWdlKFxuICAgICAgY2hhdElkLFxuICAgICAgYOeVquWPtyAke1N0cmluZyhpbmRleCl9IOOBruebo+imluOCkuS4gOaZguWBnOatouOBl+OBvuOBl+OBn+OAgmAsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiAvcmVzdW1lIOOCs+ODnuODs+ODieODj+ODs+ODieODqeODvFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVSZXN1bWVDb21tYW5kKFxuICAgIGNoYXRJZDogbnVtYmVyLFxuICAgIHVzZXI6IFVzZXIsXG4gICAgYXJnczogc3RyaW5nW10sXG4gICkge1xuICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgYXdhaXQgdGhpcy50ZWxlZ3JhbVNlcnZpY2Uuc2VuZE1lc3NhZ2UoXG4gICAgICAgIGNoYXRJZCxcbiAgICAgICAgJ+S9v+eUqOaWueazlTogL3Jlc3VtZSA855Wq5Y+3Plxcbi9saXN0IOOBp+eVquWPt+OCkueiuuiqjeOBl+OBpuOBj+OBoOOBleOBhOOAgicsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoYXJnc1swXSk7XG4gICAgaWYgKGlzTmFOKGluZGV4KSkge1xuICAgICAgYXdhaXQgdGhpcy50ZWxlZ3JhbVNlcnZpY2Uuc2VuZE1lc3NhZ2UoXG4gICAgICAgIGNoYXRJZCxcbiAgICAgICAgJ+eVquWPt+OCkuato+OBl+OBj+WFpeWKm+OBl+OBpuOBj+OBoOOBleOBhOOAgicsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRPRE86IOebo+imluWGjemWi+WHpueQhuOCkuWun+ijhVxuICAgIGF3YWl0IHRoaXMudGVsZWdyYW1TZXJ2aWNlLnNlbmRNZXNzYWdlKFxuICAgICAgY2hhdElkLFxuICAgICAgYOeVquWPtyAke1N0cmluZyhpbmRleCl9IOOBruebo+imluOCkuWGjemWi+OBl+OBvuOBl+OBn+OAgmAsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiAvc3RhdHVzIOOCs+ODnuODs+ODieODj+ODs+ODieODqeODvFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTdGF0dXNDb21tYW5kKGNoYXRJZDogbnVtYmVyLCB1c2VyOiBVc2VyKSB7XG4gICAgLy8gVE9ETzog44Om44O844K244O844Gu55uj6KaW54q25rOB44KS5Y+W5b6XXG4gICAgY29uc3QgbWVzc2FnZSA9IGBcbvCfk4og55uj6KaW54q25rOBOlxuXG7wn5GkIOODpuODvOOCtuODvDogJHt1c2VyLmZ1bGxOYW1lfVxu8J+ThSDnmbvpjLLml6U6ICR7dXNlci5jcmVhdGVkQXQudG9Mb2NhbGVEYXRlU3RyaW5nKCdqYS1KUCcpfVxu8J+UjSDnm6PoppbkuK1VUkw6IDLku7ZcbuKPuO+4jyDkuIDmmYLlgZzmraLkuK06IDHku7ZcbvCflJQg6YCa55+l6Kit5a6aOiAke3VzZXIuc2V0dGluZ3M/Lm5vdGlmaWNhdGlvbnMuZW5hYmxlZCA/ICdPTicgOiAnT0ZGJ31cblxu5pyA57WC44OB44Kn44OD44KvOiA15YiG5YmNXG7mrKHlm57jg4Hjgqfjg4Pjgq86IDEw5YiG5b6MXG4gICAgYC50cmltKCk7XG5cbiAgICBhd2FpdCB0aGlzLnRlbGVncmFtU2VydmljZS5zZW5kTWVzc2FnZShjaGF0SWQsIG1lc3NhZ2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIC9oZWxwIOOCs+ODnuODs+ODieODj+ODs+ODieODqeODvFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVIZWxwQ29tbWFuZChjaGF0SWQ6IG51bWJlcikge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBgXG7wn5OaIOOCs+ODnuODs+ODieS4gOimpzpcblxuL3N0YXJ0IC0g44Oc44OD44OI44KS6ZaL5aeLXG4vYWRkIDxVUkw+IC0g55uj6KaWVVJM44KS6L+95YqgXG4vbGlzdCAtIOeZu+mMslVSTOS4gOimp+OCkuihqOekulxuL3JlbW92ZSA855Wq5Y+3PiAtIFVSTOOCkuWJiumZpFxuL3BhdXNlIDznlarlj7c+IC0g55uj6KaW44KS5LiA5pmC5YGc5q2iXG4vcmVzdW1lIDznlarlj7c+IC0g55uj6KaW44KS5YaN6ZaLXG4vc3RhdHVzIC0g55uj6KaW54q25rOB44KS56K66KqNXG4vaGVscCAtIOOBk+OBruODmOODq+ODl+OCkuihqOekulxuXG7inZMg5L2/44GE5pa5OlxuMS4gL2FkZCDjgadVUkzjgpLnmbvpjLJcbjIuIOaWsOedgOeJqeS7tuOBjOOBguOCjOOBsOiHquWLlemAmuefpVxuMy4gL2xpc3Qg44Gn55m76Yyy54q25rOB44KS56K66KqNXG5cbuOBiuWbsOOCiuOBruWgtOWQiOOBryBAc29rdWJ1dHN1X3N1cHBvcnQg44G+44Gn44GU6YCj57Wh44GP44Gg44GV44GE44CCXG4gICAgYC50cmltKCk7XG5cbiAgICBhd2FpdCB0aGlzLnRlbGVncmFtU2VydmljZS5zZW5kTWVzc2FnZShjaGF0SWQsIG1lc3NhZ2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIOOCs+ODnuODs+ODieOCkuODkeODvOOCuVxuICAgKi9cbiAgcHJpdmF0ZSBwYXJzZUNvbW1hbmQodGV4dDogc3RyaW5nKTogeyBuYW1lOiBzdHJpbmc7IGFyZ3M6IHN0cmluZ1tdIH0ge1xuICAgIGNvbnN0IHBhcnRzID0gdGV4dC50cmltKCkuc3BsaXQoL1xccysvKTtcbiAgICBjb25zdCBuYW1lID0gcGFydHNbMF0udG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBhcmdzID0gcGFydHMuc2xpY2UoMSk7XG5cbiAgICByZXR1cm4geyBuYW1lLCBhcmdzIH07XG4gIH1cblxuICAvKipcbiAgICogVVJM5qSc6Ki8XG4gICAqL1xuICBwcml2YXRlIGlzVmFsaWRVcmwodXJsOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICB0cnkge1xuICAgICAgbmV3IFVSTCh1cmwpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=