dbdaae1439a2d966720066b9d5330871
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('axios');
jest.mock('cheerio');
jest.mock('jsdom');
jest.mock('playwright');
const testing_1 = require("@nestjs/testing");
const scraping_service_1 = require("./scraping.service");
const bot_protection_service_1 = require("../bot-protection/bot-protection.service");
const axios_1 = __importDefault(require("axios"));
const cheerio = __importStar(require("cheerio"));
const jsdom_1 = require("jsdom");
const playwright_1 = require("playwright");
describe('ScrapingService', () => {
    let service;
    const mockUrl = 'https://example.com';
    const mockSelector = '#test-selector';
    const mockContent = '<div>Test Content</div>';
    const _mockHash = 'mocked-hash';
    const mockBotProtectionService = {
        detectBot: jest.fn(),
        bypassProtection: jest.fn(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                scraping_service_1.ScrapingService,
                {
                    provide: bot_protection_service_1.BotProtectionService,
                    useValue: mockBotProtectionService,
                },
            ],
        }).compile();
        service = module.get(scraping_service_1.ScrapingService);
        // クリーンアップ
        jest.clearAllMocks();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('scrapeAndGetHash', () => {
        it('HTTP + Cheerioで成功する場合', async () => {
            // Axiosのモック
            axios_1.default.get.mockResolvedValue({
                data: '<html><body><div id="test-selector">Test Content</div></body></html>',
            });
            // Cheerioのモック
            const mockElement = {
                html: jest.fn().mockReturnValue(mockContent),
                length: 1,
            };
            const mockCheerio = {
                load: jest.fn().mockReturnValue(jest.fn().mockReturnValue(mockElement)),
            };
            cheerio.load = mockCheerio.load;
            const result = await service.scrapeAndGetHash(mockUrl, mockSelector);
            expect(result).toBeDefined();
            expect(axios_1.default.get).toHaveBeenCalledWith(mockUrl, expect.objectContaining({
                headers: expect.objectContaining({
                    'User-Agent': expect.any(String),
                }),
            }));
        });
        it('HTTP失敗時はJSDOMにフォールバック', async () => {
            // Axiosを失敗させる
            axios_1.default.get.mockRejectedValue(new Error('Network error'));
            // JSDOMのモック
            const mockElement = { innerHTML: mockContent };
            const mockDocument = {
                querySelector: jest.fn().mockReturnValue(mockElement),
            };
            const mockWindow = { document: mockDocument, close: jest.fn() };
            jsdom_1.JSDOM.fromURL.mockResolvedValue({ window: mockWindow });
            const result = await service.scrapeAndGetHash(mockUrl, mockSelector);
            expect(result).toBeDefined();
            expect(jsdom_1.JSDOM.fromURL).toHaveBeenCalled();
        });
        it('すべての手法が失敗した場合はnullを返す', async () => {
            // すべて失敗させる
            axios_1.default.get.mockRejectedValue(new Error('HTTP failed'));
            jsdom_1.JSDOM.fromURL.mockRejectedValue(new Error('JSDOM failed'));
            const mockBrowser = {
                newPage: jest.fn().mockRejectedValue(new Error('Playwright failed')),
                close: jest.fn(),
            };
            playwright_1.chromium.launch.mockResolvedValue(mockBrowser);
            const result = await service.scrapeAndGetHash(mockUrl, mockSelector);
            expect(result).toBeNull();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3R0dGVsYS9Eb2N1bWVudHMvV29yay9kZW5vZi93b3Jrcy8yNTA1Mjlzb2t1YnV0c3UvZGV2Mi9zcmMvZmVhdHVyZXMvc2NyYXBpbmcvc2NyYXBpbmcuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBUUEsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztBQVh4Qiw2Q0FBc0Q7QUFDdEQseURBQXFEO0FBQ3JELHFGQUFnRjtBQUNoRixrREFBMEI7QUFDMUIsaURBQW1DO0FBQ25DLGlDQUE4QjtBQUM5QiwyQ0FBc0M7QUFPdEMsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixJQUFJLE9BQXdCLENBQUM7SUFDN0IsTUFBTSxPQUFPLEdBQUcscUJBQXFCLENBQUM7SUFDdEMsTUFBTSxZQUFZLEdBQUcsZ0JBQWdCLENBQUM7SUFDdEMsTUFBTSxXQUFXLEdBQUcseUJBQXlCLENBQUM7SUFDOUMsTUFBTSxTQUFTLEdBQUcsYUFBYSxDQUFDO0lBRWhDLE1BQU0sd0JBQXdCLEdBQUc7UUFDL0IsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDcEIsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUM1QixDQUFDO0lBRUYsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUU7Z0JBQ1Qsa0NBQWU7Z0JBQ2Y7b0JBQ0UsT0FBTyxFQUFFLDZDQUFvQjtvQkFDN0IsUUFBUSxFQUFFLHdCQUF3QjtpQkFDbkM7YUFDRjtTQUNGLENB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QUFhLENBQUMsQ0FBQyxDQUFDO1lBQ3BFLGFBQUssQ0FBQyxPQUFxQixDQUFDLGlCQUFpQixDQUFDLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7WUFFMUUsTUFBTSxXQUFXLEdBQUc7Z0JBQ2xCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQztnQkFDcEUsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDakIsQ0FBQztZQUNELHFCQUFRLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUU5RCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUM7WUFFckUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvdHR0ZWxhL0RvY3VtZW50cy9Xb3JrL2Rlbm9mL3dvcmtzLzI1MDUyOXNva3VidXRzdS9kZXYyL3NyYy9mZWF0dXJlcy9zY3JhcGluZy9zY3JhcGluZy5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBTY3JhcGluZ1NlcnZpY2UgfSBmcm9tICcuL3NjcmFwaW5nLnNlcnZpY2UnO1xuaW1wb3J0IHsgQm90UHJvdGVjdGlvblNlcnZpY2UgfSBmcm9tICcuLi9ib3QtcHJvdGVjdGlvbi9ib3QtcHJvdGVjdGlvbi5zZXJ2aWNlJztcbmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgKiBhcyBjaGVlcmlvIGZyb20gJ2NoZWVyaW8nO1xuaW1wb3J0IHsgSlNET00gfSBmcm9tICdqc2RvbSc7XG5pbXBvcnQgeyBjaHJvbWl1bSB9IGZyb20gJ3BsYXl3cmlnaHQnO1xuXG5qZXN0Lm1vY2soJ2F4aW9zJyk7XG5qZXN0Lm1vY2soJ2NoZWVyaW8nKTtcbmplc3QubW9jaygnanNkb20nKTtcbmplc3QubW9jaygncGxheXdyaWdodCcpO1xuXG5kZXNjcmliZSgnU2NyYXBpbmdTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogU2NyYXBpbmdTZXJ2aWNlO1xuICBjb25zdCBtb2NrVXJsID0gJ2h0dHBzOi8vZXhhbXBsZS5jb20nO1xuICBjb25zdCBtb2NrU2VsZWN0b3IgPSAnI3Rlc3Qtc2VsZWN0b3InO1xuICBjb25zdCBtb2NrQ29udGVudCA9ICc8ZGl2PlRlc3QgQ29udGVudDwvZGl2Pic7XG4gIGNvbnN0IF9tb2NrSGFzaCA9ICdtb2NrZWQtaGFzaCc7XG5cbiAgY29uc3QgbW9ja0JvdFByb3RlY3Rpb25TZXJ2aWNlID0ge1xuICAgIGRldGVjdEJvdDogamVzdC5mbigpLFxuICAgIGJ5cGFzc1Byb3RlY3Rpb246IGplc3QuZm4oKSxcbiAgfTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIFNjcmFwaW5nU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IEJvdFByb3RlY3Rpb25TZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQm90UHJvdGVjdGlvblNlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PFNjcmFwaW5nU2VydmljZT4oU2NyYXBpbmdTZXJ2aWNlKTtcblxuICAgIC8vIOOCr+ODquODvOODs+OCouODg+ODl1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzY3JhcGVBbmRHZXRIYXNoJywgKCkgPT4ge1xuICAgIGl0KCdIVFRQICsgQ2hlZXJpb+OBp+aIkOWKn+OBmeOCi+WgtOWQiCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEF4aW9z44Gu44Oi44OD44KvXG4gICAgICAoYXhpb3MuZ2V0IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiAnPGh0bWw+PGJvZHk+PGRpdiBpZD1cInRlc3Qtc2VsZWN0b3JcIj5UZXN0IENvbnRlbnQ8L2Rpdj48L2JvZHk+PC9odG1sPicsXG4gICAgICB9KTtcblxuICAgICAgLy8gQ2hlZXJpb+OBruODouODg+OCr1xuICAgICAgY29uc3QgbW9ja0VsZW1lbnQgPSB7XG4gICAgICAgIGh0bWw6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobW9ja0NvbnRlbnQpLFxuICAgICAgICBsZW5ndGg6IDEsXG4gICAgICB9O1xuICAgICAgY29uc3QgbW9ja0NoZWVyaW8gPSB7XG4gICAgICAgIGxvYWQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrRWxlbWVudCkpLFxuICAgICAgfTtcbiAgICAgIChjaGVlcmlvIGFzIGFueSkubG9hZCA9IG1vY2tDaGVlcmlvLmxvYWQ7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2Uuc2NyYXBlQW5kR2V0SGFzaChtb2NrVXJsLCBtb2NrU2VsZWN0b3IpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGF4aW9zLmdldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG1vY2tVcmwsXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBoZWFkZXJzOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAnVXNlci1BZ2VudCc6IGV4cGVjdC5hbnkoU3RyaW5nKSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ0hUVFDlpLHmlZfmmYLjga9KU0RPTeOBq+ODleOCqeODvOODq+ODkOODg+OCrycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEF4aW9z44KS5aSx5pWX44GV44Gb44KLXG4gICAgICAoYXhpb3MuZ2V0IGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdOZXR3b3JrIGVycm9yJykpO1xuXG4gICAgICAvLyBKU0RPTeOBruODouODg+OCr1xuICAgICAgY29uc3QgbW9ja0VsZW1lbnQgPSB7IGlubmVySFRNTDogbW9ja0NvbnRlbnQgfTtcbiAgICAgIGNvbnN0IG1vY2tEb2N1bWVudCA9IHtcbiAgICAgICAgcXVlcnlTZWxlY3RvcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrRWxlbWVudCksXG4gICAgICB9O1xuICAgICAgY29uc3QgbW9ja1dpbmRvdyA9IHsgZG9jdW1lbnQ6IG1vY2tEb2N1bWVudCwgY2xvc2U6IGplc3QuZm4oKSB9O1xuICAgICAgKEpTRE9NLmZyb21VUkwgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHdpbmRvdzogbW9ja1dpbmRvdyB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5zY3JhcGVBbmRHZXRIYXNoKG1vY2tVcmwsIG1vY2tTZWxlY3Rvcik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoSlNET00uZnJvbVVSTCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+OBmeOBueOBpuOBruaJi+azleOBjOWkseaVl+OBl+OBn+WgtOWQiOOBr251bGzjgpLov5TjgZknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyDjgZnjgbnjgablpLHmlZfjgZXjgZvjgotcbiAgICAgIChheGlvcy5nZXQgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0hUVFAgZmFpbGVkJykpO1xuICAgICAgKEpTRE9NLmZyb21VUkwgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0pTRE9NIGZhaWxlZCcpKTtcblxuICAgICAgY29uc3QgbW9ja0Jyb3dzZXIgPSB7XG4gICAgICAgIG5ld1BhZ2U6IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1BsYXl3cmlnaHQgZmFpbGVkJykpLFxuICAgICAgICBjbG9zZTogamVzdC5mbigpLFxuICAgICAgfTtcbiAgICAgIChjaHJvbWl1bS5sYXVuY2ggYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQnJvd3Nlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2Uuc2NyYXBlQW5kR2V0SGFzaChtb2NrVXJsLCBtb2NrU2VsZWN0b3IpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9