e423d7ea842584ee9a188893b3b8e463
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ErrorClassifier = exports.ValidationError = exports.AuthenticationError = exports.ResourceLimitError = exports.BrowserError = exports.ParsingError = exports.BotDetectionError = exports.TimeoutError = exports.NetworkError = exports.ScrapingError = void 0;
/**
 * スクレイピングエラーの基底クラス
 */
class ScrapingError extends Error {
    code;
    timestamp;
    context;
    recoverable;
    constructor(message, code, recoverable = false, context = {}) {
        super(message);
        this.name = this.constructor.name;
        this.code = code;
        this.timestamp = new Date();
        this.recoverable = recoverable;
        this.context = context;
        // Maintains proper stack trace for where our error was thrown (only available on V8)
        if ('captureStackTrace' in Error &&
            typeof Error.captureStackTrace === 'function') {
            Error.captureStackTrace(this, this.constructor);
        }
    }
    /**
     * エラーの詳細情報を取得
     */
    getDetails() {
        return {
            name: this.name,
            code: this.code,
            message: this.message,
            timestamp: this.timestamp,
            recoverable: this.recoverable,
            context: this.context,
            stack: this.stack,
        };
    }
}
exports.ScrapingError = ScrapingError;
/**
 * ネットワーク関連エラー
 */
class NetworkError extends ScrapingError {
    constructor(message, context = {}) {
        super(message, 'NETWORK_ERROR', true, context);
    }
}
exports.NetworkError = NetworkError;
/**
 * タイムアウトエラー
 */
class TimeoutError extends ScrapingError {
    constructor(message, timeoutMs, context = {}) {
        super(message, 'TIMEOUT_ERROR', true, { ...context, timeoutMs });
    }
}
exports.TimeoutError = TimeoutError;
/**
 * Bot検知エラー
 */
class BotDetectionError extends ScrapingError {
    detectionType;
    constructor(message, detectionType = 'unknown', context = {}) {
        super(message, 'BOT_DETECTION_ERROR', detectionType === 'captcha', // CAPTCHAの場合は回復可能
        { ...context, detectionType });
        this.detectionType = detectionType;
    }
}
exports.BotDetectionError = BotDetectionError;
/**
 * コンテンツパースエラー
 */
class ParsingError extends ScrapingError {
    constructor(message, selector, context = {}) {
        super(message, 'PARSING_ERROR', false, { ...context, selector });
    }
}
exports.ParsingError = ParsingError;
/**
 * ブラウザエラー
 */
class BrowserError extends ScrapingError {
    constructor(message, browserError, context = {}) {
        super(message, 'BROWSER_ERROR', true, {
            ...context,
            originalError: browserError?.message,
            originalStack: browserError?.stack,
        });
    }
}
exports.BrowserError = BrowserError;
/**
 * リソース制限エラー
 */
class ResourceLimitError extends ScrapingError {
    resourceType;
    constructor(message, resourceType, context = {}) {
        super(message, 'RESOURCE_LIMIT_ERROR', true, { ...context, resourceType });
        this.resourceType = resourceType;
    }
}
exports.ResourceLimitError = ResourceLimitError;
/**
 * 認証エラー
 */
class AuthenticationError extends ScrapingError {
    constructor(message, context = {}) {
        super(message, 'AUTHENTICATION_ERROR', false, context);
    }
}
exports.AuthenticationError = AuthenticationError;
/**
 * データ検証エラー
 */
class ValidationError extends ScrapingError {
    validationErrors;
    constructor(message, validationErrors = [], context = {}) {
        super(message, 'VALIDATION_ERROR', false, { ...context, validationErrors });
        this.validationErrors = validationErrors;
    }
}
exports.ValidationError = ValidationError;
/**
 * エラー分類ユーティリティ
 */
exports.ErrorClassifier = {
    /**
     * エラーを分類して適切なScrapingErrorに変換
     */
    classify(error, context = {}) {
        const message = error.message.toLowerCase();
        // タイムアウト検出
        if (message.includes('timeout') || message.includes('timed out')) {
            const timeoutMatch = message.match(/(\d+)ms/);
            const timeoutMs = timeoutMatch ? parseInt(timeoutMatch[1]) : 0;
            return new TimeoutError(error.message, timeoutMs, context);
        }
        // ネットワークエラー検出
        if (message.includes('network') ||
            message.includes('connection') ||
            message.includes('econnrefused') ||
            message.includes('dns')) {
            return new NetworkError(error.message, context);
        }
        // Bot検知エラー
        if (message.includes('captcha') || message.includes('/sorry/')) {
            return new BotDetectionError(error.message, 'captcha', context);
        }
        if (message.includes('blocked') || message.includes('forbidden')) {
            return new BotDetectionError(error.message, 'block', context);
        }
        // ブラウザエラー
        if (message.includes('browser') ||
            message.includes('page') ||
            message.includes('context') ||
            error.name === 'TargetClosedError') {
            return new BrowserError(error.message, error, context);
        }
        // パースエラー
        if (message.includes('selector') ||
            message.includes('element') ||
            message.includes('parse')) {
            return new ParsingError(error.message, undefined, context);
        }
        // デフォルト: 一般的なスクレイピングエラー
        return new (class extends ScrapingError {
            constructor() {
                super(error.message, 'UNKNOWN_ERROR', false, context);
            }
        })();
    },
    /**
     * エラーが回復可能かどうかを判定
     */
    isRecoverable(error) {
        if (error instanceof ScrapingError) {
            return error.recoverable;
        }
        // ScrapingErrorでない場合は分類して判定
        const classified = exports.ErrorClassifier.classify(error);
        return classified.recoverable;
    },
    /**
     * リトライ戦略の提案
     */
    suggestRetryStrategy(error) {
        if (!error.recoverable) {
            return {
                shouldRetry: false,
                delay: 0,
                maxRetries: 0,
                strategy: 'no_retry',
            };
        }
        switch (error.code) {
            case 'TIMEOUT_ERROR':
                return {
                    shouldRetry: true,
                    delay: 2000,
                    maxRetries: 3,
                    strategy: 'exponential_backoff',
                };
            case 'NETWORK_ERROR':
                return {
                    shouldRetry: true,
                    delay: 1000,
                    maxRetries: 5,
                    strategy: 'exponential_backoff_with_jitter',
                };
            case 'BOT_DETECTION_ERROR':
                if (error instanceof BotDetectionError &&
                    error.detectionType === 'captcha') {
                    return {
                        shouldRetry: true,
                        delay: 30000, // 30秒待機
                        maxRetries: 2,
                        strategy: 'fixed_delay_with_strategy_change',
                    };
                }
                return {
                    shouldRetry: false,
                    delay: 0,
                    maxRetries: 0,
                    strategy: 'no_retry',
                };
            case 'RESOURCE_LIMIT_ERROR':
                return {
                    shouldRetry: true,
                    delay: 5000,
                    maxRetries: 3,
                    strategy: 'linear_backoff',
                };
            case 'BROWSER_ERROR':
                return {
                    shouldRetry: true,
                    delay: 3000,
                    maxRetries: 2,
                    strategy: 'fixed_delay',
                };
            default:
                return {
                    shouldRetry: true,
                    delay: 1000,
                    maxRetries: 3,
                    strategy: 'exponential_backoff',
                };
        }
    },
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3R0dGVsYS9Eb2N1bWVudHMvV29yay9kZW5vZi93b3Jrcy8yNTA1Mjlzb2t1YnV0c3UvZGV2Mi9zcmMvY29tbW9uL2V4Y2VwdGlvbnMvc2NyYXBpbmcuZXhjZXB0aW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQTs7R0FFRztBQUNILE1BQXNCLGFBQWMsU0FBUSxLQUFLO0lBQy9CLElBQUksQ0FBUztJQUNiLFNBQVMsQ0FBTztJQUNoQixPQUFPLENBQXNCO0lBQzdCLFdBQVcsQ0FBVTtJQUVyQyxZQUNFLE9BQWUsRUFDZixJQUFZLEVBQ1osY0FBdUIsS0FBSyxFQUM1QixVQUErQixFQUFFO1FBRWpDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUM7UUFDbEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBRXZCLHFGQUFxRjtRQUNyRixJQUNFLG1CQUFtQixJQUFJLEtBQUs7WUFDNUIsT0FBTyxLQUFLLENBQUMsaUJBQWlCLEtBQUssVUFBVSxFQUM3QyxDQUFDO1lBQ0QsS0FBSyxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDbEQsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILFVBQVU7UUFTUixPQUFPO1lBQ0wsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1lBQ3JCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztZQUN6QixXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7WUFDN0IsT0FBTyxF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RUFBRSxDQUFDO29CQUNiLFFBQVEsRUFBRSxVQUFVO2lCQUNyQixDQUFDO1lBRUosS0FBSyxzQkFBc0I7Z0JBQ3pCLE9BQU87b0JBQ0wsV0FBVyxFQUFFLElBQUk7b0JBQ2pCLEtBQUssRUFBRSxJQUFJO29CQUNYLFVBQVUsRUFBRSxDQUFDO29CQUNiLFFBQVEsRUFBRSxnQkFBZ0I7aUJBQzNCLENBQUM7WUFFSixLQUFLLGVBQWU7Z0JBQ2xCLE9BQU87b0JBQ0wsV0FBVyxFQUFFLElBQUk7b0JBQ2pCLEtBQUssRUFBRSxJQUFJO29CQUNYLFVBQVUsRUFBRSxDQUFDO29CQUNiLFFBQVEsRUFBRSxhQUFhO2lCQUN4QixDQUFDO1lBRUo7Z0JBQ0UsT0FBTztvQkFDTCxXQUFXLEVBQUUsSUFBSTtvQkFDakIsS0FBSyxFQUFFLElBQUk7b0JBQ1gsVUFBVSxFQUFFLENBQUM7b0JBQ2IsUUFBUSxFQUFFLHFCQUFxQjtpQkFDaEMsQ0FBQztRQUNOLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvdHR0ZWxhL0RvY3VtZW50cy9Xb3JrL2Rlbm9mL3dvcmtzLzI1MDUyOXNva3VidXRzdS9kZXYyL3NyYy9jb21tb24vZXhjZXB0aW9ucy9zY3JhcGluZy5leGNlcHRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICog44K544Kv44Os44Kk44OU44Oz44Kw44Ko44Op44O844Gu5Z+65bqV44Kv44Op44K5XG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBTY3JhcGluZ0Vycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBwdWJsaWMgcmVhZG9ubHkgY29kZTogc3RyaW5nO1xuICBwdWJsaWMgcmVhZG9ubHkgdGltZXN0YW1wOiBEYXRlO1xuICBwdWJsaWMgcmVhZG9ubHkgY29udGV4dDogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgcHVibGljIHJlYWRvbmx5IHJlY292ZXJhYmxlOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBjb2RlOiBzdHJpbmcsXG4gICAgcmVjb3ZlcmFibGU6IGJvb2xlYW4gPSBmYWxzZSxcbiAgICBjb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30sXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9IHRoaXMuY29uc3RydWN0b3IubmFtZTtcbiAgICB0aGlzLmNvZGUgPSBjb2RlO1xuICAgIHRoaXMudGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICB0aGlzLnJlY292ZXJhYmxlID0gcmVjb3ZlcmFibGU7XG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcblxuICAgIC8vIE1haW50YWlucyBwcm9wZXIgc3RhY2sgdHJhY2UgZm9yIHdoZXJlIG91ciBlcnJvciB3YXMgdGhyb3duIChvbmx5IGF2YWlsYWJsZSBvbiBWOClcbiAgICBpZiAoXG4gICAgICAnY2FwdHVyZVN0YWNrVHJhY2UnIGluIEVycm9yICYmXG4gICAgICB0eXBlb2YgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UgPT09ICdmdW5jdGlvbidcbiAgICApIHtcbiAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIHRoaXMuY29uc3RydWN0b3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDjgqjjg6njg7zjga7oqbPntLDmg4XloLHjgpLlj5blvpdcbiAgICovXG4gIGdldERldGFpbHMoKToge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIHRpbWVzdGFtcDogRGF0ZTtcbiAgICByZWNvdmVyYWJsZTogYm9vbGVhbjtcbiAgICBjb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIHN0YWNrPzogc3RyaW5nO1xuICB9IHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgY29kZTogdGhpcy5jb2RlLFxuICAgICAgbWVzc2FnZTogdGhpcy5tZXNzYWdlLFxuICAgICAgdGltZXN0YW1wOiB0aGlzLnRpbWVzdGFtcCxcbiAgICAgIHJlY292ZXJhYmxlOiB0aGlzLnJlY292ZXJhYmxlLFxuICAgICAgY29udGV4dDogdGhpcy5jb250ZXh0LFxuICAgICAgc3RhY2s6IHRoaXMuc3RhY2ssXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIOODjeODg+ODiOODr+ODvOOCr+mWoumAo+OCqOODqeODvFxuICovXG5leHBvcnQgY2xhc3MgTmV0d29ya0Vycm9yIGV4dGVuZHMgU2NyYXBpbmdFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dDogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KSB7XG4gICAgc3VwZXIobWVzc2FnZSwgJ05FVFdPUktfRVJST1InLCB0cnVlLCBjb250ZXh0KTtcbiAgfVxufVxuXG4vKipcbiAqIOOCv+OCpOODoOOCouOCpuODiOOCqOODqeODvFxuICovXG5leHBvcnQgY2xhc3MgVGltZW91dEVycm9yIGV4dGVuZHMgU2NyYXBpbmdFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICB0aW1lb3V0TXM6IG51bWJlcixcbiAgICBjb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30sXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UsICdUSU1FT1VUX0VSUk9SJywgdHJ1ZSwgeyAuLi5jb250ZXh0LCB0aW1lb3V0TXMgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBCb3TmpJznn6Xjgqjjg6njg7xcbiAqL1xuZXhwb3J0IGNsYXNzIEJvdERldGVjdGlvbkVycm9yIGV4dGVuZHMgU2NyYXBpbmdFcnJvciB7XG4gIHB1YmxpYyByZWFkb25seSBkZXRlY3Rpb25UeXBlOiAnY2FwdGNoYScgfCAnYmxvY2snIHwgJ2NoYWxsZW5nZScgfCAndW5rbm93bic7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIGRldGVjdGlvblR5cGU6ICdjYXB0Y2hhJyB8ICdibG9jaycgfCAnY2hhbGxlbmdlJyB8ICd1bmtub3duJyA9ICd1bmtub3duJyxcbiAgICBjb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30sXG4gICkge1xuICAgIHN1cGVyKFxuICAgICAgbWVzc2FnZSxcbiAgICAgICdCT1RfREVURUNUSU9OX0VSUk9SJyxcbiAgICAgIGRldGVjdGlvblR5cGUgPT09ICdjYXB0Y2hhJywgLy8gQ0FQVENIQeOBruWgtOWQiOOBr+WbnuW+qeWPr+iDvVxuICAgICAgeyAuLi5jb250ZXh0LCBkZXRlY3Rpb25UeXBlIH0sXG4gICAgKTtcbiAgICB0aGlzLmRldGVjdGlvblR5cGUgPSBkZXRlY3Rpb25UeXBlO1xuICB9XG59XG5cbi8qKlxuICog44Kz44Oz44OG44Oz44OE44OR44O844K544Ko44Op44O8XG4gKi9cbmV4cG9ydCBjbGFzcyBQYXJzaW5nRXJyb3IgZXh0ZW5kcyBTY3JhcGluZ0Vycm9yIHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIHNlbGVjdG9yPzogc3RyaW5nLFxuICAgIGNvbnRleHQ6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSxcbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgJ1BBUlNJTkdfRVJST1InLCBmYWxzZSwgeyAuLi5jb250ZXh0LCBzZWxlY3RvciB9KTtcbiAgfVxufVxuXG4vKipcbiAqIOODluODqeOCpuOCtuOCqOODqeODvFxuICovXG5leHBvcnQgY2xhc3MgQnJvd3NlckVycm9yIGV4dGVuZHMgU2NyYXBpbmdFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBicm93c2VyRXJyb3I/OiBFcnJvcixcbiAgICBjb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30sXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UsICdCUk9XU0VSX0VSUk9SJywgdHJ1ZSwge1xuICAgICAgLi4uY29udGV4dCxcbiAgICAgIG9yaWdpbmFsRXJyb3I6IGJyb3dzZXJFcnJvcj8ubWVzc2FnZSxcbiAgICAgIG9yaWdpbmFsU3RhY2s6IGJyb3dzZXJFcnJvcj8uc3RhY2ssXG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiDjg6rjgr3jg7zjgrnliLbpmZDjgqjjg6njg7xcbiAqL1xuZXhwb3J0IGNsYXNzIFJlc291cmNlTGltaXRFcnJvciBleHRlbmRzIFNjcmFwaW5nRXJyb3Ige1xuICBwdWJsaWMgcmVhZG9ubHkgcmVzb3VyY2VUeXBlOlxuICAgIHwgJ21lbW9yeSdcbiAgICB8ICdjcHUnXG4gICAgfCAnYnJvd3Nlcl9wb29sJ1xuICAgIHwgJ3JhdGVfbGltaXQnO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICByZXNvdXJjZVR5cGU6ICdtZW1vcnknIHwgJ2NwdScgfCAnYnJvd3Nlcl9wb29sJyB8ICdyYXRlX2xpbWl0JyxcbiAgICBjb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30sXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UsICdSRVNPVVJDRV9MSU1JVF9FUlJPUicsIHRydWUsIHsgLi4uY29udGV4dCwgcmVzb3VyY2VUeXBlIH0pO1xuICAgIHRoaXMucmVzb3VyY2VUeXBlID0gcmVzb3VyY2VUeXBlO1xuICB9XG59XG5cbi8qKlxuICog6KqN6Ki844Ko44Op44O8XG4gKi9cbmV4cG9ydCBjbGFzcyBBdXRoZW50aWNhdGlvbkVycm9yIGV4dGVuZHMgU2NyYXBpbmdFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dDogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KSB7XG4gICAgc3VwZXIobWVzc2FnZSwgJ0FVVEhFTlRJQ0FUSU9OX0VSUk9SJywgZmFsc2UsIGNvbnRleHQpO1xuICB9XG59XG5cbi8qKlxuICog44OH44O844K/5qSc6Ki844Ko44Op44O8XG4gKi9cbmV4cG9ydCBjbGFzcyBWYWxpZGF0aW9uRXJyb3IgZXh0ZW5kcyBTY3JhcGluZ0Vycm9yIHtcbiAgcHVibGljIHJlYWRvbmx5IHZhbGlkYXRpb25FcnJvcnM6IEFycmF5PHtcbiAgICBmaWVsZDogc3RyaW5nO1xuICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICB2YWx1ZT86IGFueTtcbiAgfT47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIHZhbGlkYXRpb25FcnJvcnM6IEFycmF5PHtcbiAgICAgIGZpZWxkOiBzdHJpbmc7XG4gICAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgICB2YWx1ZT86IGFueTtcbiAgICB9PiA9IFtdLFxuICAgIGNvbnRleHQ6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSxcbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgJ1ZBTElEQVRJT05fRVJST1InLCBmYWxzZSwgeyAuLi5jb250ZXh0LCB2YWxpZGF0aW9uRXJyb3JzIH0pO1xuICAgIHRoaXMudmFsaWRhdGlvbkVycm9ycyA9IHZhbGlkYXRpb25FcnJvcnM7XG4gIH1cbn1cblxuLyoqXG4gKiDjgqjjg6njg7zliIbpoZ7jg6bjg7zjg4bjgqPjg6rjg4bjgqNcbiAqL1xuZXhwb3J0IGNvbnN0IEVycm9yQ2xhc3NpZmllciA9IHtcbiAgLyoqXG4gICAqIOOCqOODqeODvOOCkuWIhumhnuOBl+OBpumBqeWIh+OBqlNjcmFwaW5nRXJyb3LjgavlpInmj5tcbiAgICovXG4gIGNsYXNzaWZ5KGVycm9yOiBFcnJvciwgY29udGV4dDogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KTogU2NyYXBpbmdFcnJvciB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2UudG9Mb3dlckNhc2UoKTtcblxuICAgIC8vIOOCv+OCpOODoOOCouOCpuODiOaknOWHulxuICAgIGlmIChtZXNzYWdlLmluY2x1ZGVzKCd0aW1lb3V0JykgfHwgbWVzc2FnZS5pbmNsdWRlcygndGltZWQgb3V0JykpIHtcbiAgICAgIGNvbnN0IHRpbWVvdXRNYXRjaCA9IG1lc3NhZ2UubWF0Y2goLyhcXGQrKW1zLyk7XG4gICAgICBjb25zdCB0aW1lb3V0TXMgPSB0aW1lb3V0TWF0Y2ggPyBwYXJzZUludCh0aW1lb3V0TWF0Y2hbMV0pIDogMDtcbiAgICAgIHJldHVybiBuZXcgVGltZW91dEVycm9yKGVycm9yLm1lc3NhZ2UsIHRpbWVvdXRNcywgY29udGV4dCk7XG4gICAgfVxuXG4gICAgLy8g44ON44OD44OI44Ov44O844Kv44Ko44Op44O85qSc5Ye6XG4gICAgaWYgKFxuICAgICAgbWVzc2FnZS5pbmNsdWRlcygnbmV0d29yaycpIHx8XG4gICAgICBtZXNzYWdlLmluY2x1ZGVzKCdjb25uZWN0aW9uJykgfHxcbiAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoJ2Vjb25ucmVmdXNlZCcpIHx8XG4gICAgICBtZXNzYWdlLmluY2x1ZGVzKCdkbnMnKVxuICAgICkge1xuICAgICAgcmV0dXJuIG5ldyBOZXR3b3JrRXJyb3IoZXJyb3IubWVzc2FnZSwgY29udGV4dCk7XG4gICAgfVxuXG4gICAgLy8gQm905qSc55+l44Ko44Op44O8XG4gICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJ2NhcHRjaGEnKSB8fCBtZXNzYWdlLmluY2x1ZGVzKCcvc29ycnkvJykpIHtcbiAgICAgIHJldHVybiBuZXcgQm90RGV0ZWN0aW9uRXJyb3IoZXJyb3IubWVzc2FnZSwgJ2NhcHRjaGEnLCBjb250ZXh0KTtcbiAgICB9XG5cbiAgICBpZiAobWVzc2FnZS5pbmNsdWRlcygnYmxvY2tlZCcpIHx8IG1lc3NhZ2UuaW5jbHVkZXMoJ2ZvcmJpZGRlbicpKSB7XG4gICAgICByZXR1cm4gbmV3IEJvdERldGVjdGlvbkVycm9yKGVycm9yLm1lc3NhZ2UsICdibG9jaycsIGNvbnRleHQpO1xuICAgIH1cblxuICAgIC8vIOODluODqeOCpuOCtuOCqOODqeODvFxuICAgIGlmIChcbiAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoJ2Jyb3dzZXInKSB8fFxuICAgICAgbWVzc2FnZS5pbmNsdWRlcygncGFnZScpIHx8XG4gICAgICBtZXNzYWdlLmluY2x1ZGVzKCdjb250ZXh0JykgfHxcbiAgICAgIGVycm9yLm5hbWUgPT09ICdUYXJnZXRDbG9zZWRFcnJvcidcbiAgICApIHtcbiAgICAgIHJldHVybiBuZXcgQnJvd3NlckVycm9yKGVycm9yLm1lc3NhZ2UsIGVycm9yLCBjb250ZXh0KTtcbiAgICB9XG5cbiAgICAvLyDjg5Hjg7zjgrnjgqjjg6njg7xcbiAgICBpZiAoXG4gICAgICBtZXNzYWdlLmluY2x1ZGVzKCdzZWxlY3RvcicpIHx8XG4gICAgICBtZXNzYWdlLmluY2x1ZGVzKCdlbGVtZW50JykgfHxcbiAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoJ3BhcnNlJylcbiAgICApIHtcbiAgICAgIHJldHVybiBuZXcgUGFyc2luZ0Vycm9yKGVycm9yLm1lc3NhZ2UsIHVuZGVmaW5lZCwgY29udGV4dCk7XG4gICAgfVxuXG4gICAgLy8g44OH44OV44Kp44Or44OIOiDkuIDoiKznmoTjgarjgrnjgq/jg6zjgqTjg5Tjg7PjgrDjgqjjg6njg7xcbiAgICByZXR1cm4gbmV3IChjbGFzcyBleHRlbmRzIFNjcmFwaW5nRXJyb3Ige1xuICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKGVycm9yLm1lc3NhZ2UsICdVTktOT1dOX0VSUk9SJywgZmFsc2UsIGNvbnRleHQpO1xuICAgICAgfVxuICAgIH0pKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOOCqOODqeODvOOBjOWbnuW+qeWPr+iDveOBi+OBqeOBhuOBi+OCkuWIpOWumlxuICAgKi9cbiAgaXNSZWNvdmVyYWJsZShlcnJvcjogRXJyb3IpOiBib29sZWFuIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBTY3JhcGluZ0Vycm9yKSB7XG4gICAgICByZXR1cm4gZXJyb3IucmVjb3ZlcmFibGU7XG4gICAgfVxuXG4gICAgLy8gU2NyYXBpbmdFcnJvcuOBp+OBquOBhOWgtOWQiOOBr+WIhumhnuOBl+OBpuWIpOWumlxuICAgIGNvbnN0IGNsYXNzaWZpZWQgPSBFcnJvckNsYXNzaWZpZXIuY2xhc3NpZnkoZXJyb3IpO1xuICAgIHJldHVybiBjbGFzc2lmaWVkLnJlY292ZXJhYmxlO1xuICB9LFxuXG4gIC8qKlxuICAgKiDjg6rjg4jjg6njgqTmiKbnlaXjga7mj5DmoYhcbiAgICovXG4gIHN1Z2dlc3RSZXRyeVN0cmF0ZWd5KGVycm9yOiBTY3JhcGluZ0Vycm9yKToge1xuICAgIHNob3VsZFJldHJ5OiBib29sZWFuO1xuICAgIGRlbGF5OiBudW1iZXI7XG4gICAgbWF4UmV0cmllczogbnVtYmVyO1xuICAgIHN0cmF0ZWd5OiBzdHJpbmc7XG4gIH0ge1xuICAgIGlmICghZXJyb3IucmVjb3ZlcmFibGUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNob3VsZFJldHJ5OiBmYWxzZSxcbiAgICAgICAgZGVsYXk6IDAsXG4gICAgICAgIG1heFJldHJpZXM6IDAsXG4gICAgICAgIHN0cmF0ZWd5OiAnbm9fcmV0cnknLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKGVycm9yLmNvZGUpIHtcbiAgICAgIGNhc2UgJ1RJTUVPVVRfRVJST1InOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNob3VsZFJldHJ5OiB0cnVlLFxuICAgICAgICAgIGRlbGF5OiAyMDAwLFxuICAgICAgICAgIG1heFJldHJpZXM6IDMsXG4gICAgICAgICAgc3RyYXRlZ3k6ICdleHBvbmVudGlhbF9iYWNrb2ZmJyxcbiAgICAgICAgfTtcblxuICAgICAgY2FzZSAnTkVUV09SS19FUlJPUic6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc2hvdWxkUmV0cnk6IHRydWUsXG4gICAgICAgICAgZGVsYXk6IDEwMDAsXG4gICAgICAgICAgbWF4UmV0cmllczogNSxcbiAgICAgICAgICBzdHJhdGVneTogJ2V4cG9uZW50aWFsX2JhY2tvZmZfd2l0aF9qaXR0ZXInLFxuICAgICAgICB9O1xuXG4gICAgICBjYXNlICdCT1RfREVURUNUSU9OX0VSUk9SJzpcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgQm90RGV0ZWN0aW9uRXJyb3IgJiZcbiAgICAgICAgICBlcnJvci5kZXRlY3Rpb25UeXBlID09PSAnY2FwdGNoYSdcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNob3VsZFJldHJ5OiB0cnVlLFxuICAgICAgICAgICAgZGVsYXk6IDMwMDAwLCAvLyAzMOenkuW+heapn1xuICAgICAgICAgICAgbWF4UmV0cmllczogMixcbiAgICAgICAgICAgIHN0cmF0ZWd5OiAnZml4ZWRfZGVsYXlfd2l0aF9zdHJhdGVneV9jaGFuZ2UnLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzaG91bGRSZXRyeTogZmFsc2UsXG4gICAgICAgICAgZGVsYXk6IDAsXG4gICAgICAgICAgbWF4UmV0cmllczogMCxcbiAgICAgICAgICBzdHJhdGVneTogJ25vX3JldHJ5JyxcbiAgICAgICAgfTtcblxuICAgICAgY2FzZSAnUkVTT1VSQ0VfTElNSVRfRVJST1InOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNob3VsZFJldHJ5OiB0cnVlLFxuICAgICAgICAgIGRlbGF5OiA1MDAwLFxuICAgICAgICAgIG1heFJldHJpZXM6IDMsXG4gICAgICAgICAgc3RyYXRlZ3k6ICdsaW5lYXJfYmFja29mZicsXG4gICAgICAgIH07XG5cbiAgICAgIGNhc2UgJ0JST1dTRVJfRVJST1InOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNob3VsZFJldHJ5OiB0cnVlLFxuICAgICAgICAgIGRlbGF5OiAzMDAwLFxuICAgICAgICAgIG1heFJldHJpZXM6IDIsXG4gICAgICAgICAgc3RyYXRlZ3k6ICdmaXhlZF9kZWxheScsXG4gICAgICAgIH07XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc2hvdWxkUmV0cnk6IHRydWUsXG4gICAgICAgICAgZGVsYXk6IDEwMDAsXG4gICAgICAgICAgbWF4UmV0cmllczogMyxcbiAgICAgICAgICBzdHJhdGVneTogJ2V4cG9uZW50aWFsX2JhY2tvZmYnLFxuICAgICAgICB9O1xuICAgIH1cbiAgfSxcbn07XG4iXSwidmVyc2lvbiI6M30=