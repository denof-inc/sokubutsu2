# é–‹ç™ºç’°å¢ƒæ§‹ç¯‰æ‰‹é †æ›¸ - è»½é‡ã‚½ã‚¯ãƒ–ãƒ„

## æ¦‚è¦

è»½é‡ã‚½ã‚¯ãƒ–ãƒ„ã¯ã€è‡ªå®…ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒã§ã®ç‰©ä»¶æ–°ç€ç›£è¦–ã«ç‰¹åŒ–ã—ãŸé–‹ç™ºç’°å¢ƒã‚’æä¾›ã—ã¾ã™ã€‚Dockerã‚’ä½¿ç”¨ã›ãšã€ãƒã‚¤ãƒ†ã‚£ãƒ–å®Ÿè¡Œã«ã‚ˆã‚‹è»½é‡ãƒ»é«˜é€Ÿé–‹ç™ºç’°å¢ƒã«ã‚ˆã‚Šã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡20-40MBã€èµ·å‹•æ™‚é–“1-2ç§’ã®é«˜é€Ÿé–‹ç™ºã‚µã‚¤ã‚¯ãƒ«ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## é–‹ç™ºç’°å¢ƒè¦ä»¶

### ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¦ä»¶

#### æœ€å°è¦ä»¶
- **CPU**: 2ã‚³ã‚¢ä»¥ä¸Š
- **ãƒ¡ãƒ¢ãƒª**: 4GBä»¥ä¸Šï¼ˆè»½é‡ã‚½ã‚¯ãƒ–ãƒ„ã¯20-40MBä½¿ç”¨ï¼‰
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: 5GBä»¥ä¸Šã®ç©ºãå®¹é‡
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: å®‰å®šã—ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š

#### æ¨å¥¨è¦ä»¶
- **CPU**: 4ã‚³ã‚¢ä»¥ä¸Šï¼ˆIntel Core i5 / AMD Ryzen 5ä»¥ä¸Šï¼‰
- **ãƒ¡ãƒ¢ãƒª**: 8GBä»¥ä¸Š
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: 20GBä»¥ä¸Šã®SSD
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: é«˜é€Ÿã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š

### ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¦ä»¶

#### å¿…é ˆã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢
- **Node.js**: 18.0ä»¥ä¸Šï¼ˆæ¨å¥¨: 20.18.0ï¼‰
- **npm/pnpm**: æœ€æ–°ç‰ˆ
- **Git**: 2.30ä»¥ä¸Š
- **SQLite3**: 3.35ä»¥ä¸Š

#### æ¨å¥¨ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢
- **Visual Studio Code**: æœ€æ–°ç‰ˆ
- **Postman**: API ãƒ†ã‚¹ãƒˆç”¨
- **DBeaver**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ç”¨
- **PM2**: ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ç”¨

### å¯¾å¿œOS

#### Windows
- **Windows 10**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³2004ä»¥ä¸Š
- **Windows 11**: å…¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³
- **WSL2**: Ubuntu 20.04 LTSä»¥ä¸Š

#### macOS
- **macOS Big Sur**: 11.0ä»¥ä¸Š
- **macOS Monterey**: 12.0ä»¥ä¸Š
- **macOS Ventura**: 13.0ä»¥ä¸Š

#### Linux
- **Ubuntu**: 20.04 LTSä»¥ä¸Š
- **CentOS**: 8ä»¥ä¸Š
- **Debian**: 11ä»¥ä¸Š
- **Fedora**: 35ä»¥ä¸Š

## ç’°å¢ƒæ§‹ç¯‰æ‰‹é †

### 1. Node.jsç’°å¢ƒæ§‹ç¯‰

#### Windowsï¼ˆWSL2æ¨å¥¨ï¼‰

```powershell
# WSL2æœ‰åŠ¹åŒ–
wsl --install

# Ubuntu 22.04ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
wsl --install -d Ubuntu-22.04

# WSL2å†…ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ
```

```bash
# ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°
sudo apt update && sudo apt upgrade -y

# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install -y curl wget git build-essential python3 python3-pip

# Node.js 20.x ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# pnpm ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g pnpm

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
node --version  # v20.18.0ä»¥ä¸Š
npm --version   # 10.0.0ä»¥ä¸Š
pnpm --version  # 8.0.0ä»¥ä¸Š
```

#### macOS

```bash
# Homebrew ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆï¼‰
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Node.js ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
brew install node@20

# ãƒ‘ã‚¹ã‚’é€šã™
echo 'export PATH="/opt/homebrew/opt/node@20/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc

# pnpm ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g pnpm

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
node --version
npm --version
pnpm --version
```

#### Linuxï¼ˆUbuntu/Debianï¼‰

```bash
# ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°
sudo apt update && sudo apt upgrade -y

# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install -y curl wget git build-essential python3 python3-pip

# Node.js 20.x ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# pnpm ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g pnpm

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
node --version
npm --version
pnpm --version
```

### 2. é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

#### Visual Studio Code

```bash
# Windowsï¼ˆWSL2ï¼‰
# Windowså´ã§VS Codeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€WSLæ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

# macOS
brew install --cask visual-studio-code

# Linuxï¼ˆUbuntu/Debianï¼‰
wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > packages.microsoft.gpg
sudo install -o root -g root -m 644 packages.microsoft.gpg /etc/apt/trusted.gpg.d/
sudo sh -c 'echo "deb [arch=amd64,arm64,armhf signed-by=/etc/apt/trusted.gpg.d/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main" > /etc/apt/sources.list.d/vscode.list'
sudo apt update
sudo apt install code
```

#### Gitè¨­å®š

```bash
# Gitè¨­å®š
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
git config --global init.defaultBranch main

# SSH ã‚­ãƒ¼ç”Ÿæˆï¼ˆGitHubç”¨ï¼‰
ssh-keygen -t ed25519 -C "your.email@example.com"

# SSH ã‚­ãƒ¼ã‚’GitHubã«è¿½åŠ 
cat ~/.ssh/id_ed25519.pub
# å‡ºåŠ›ã•ã‚ŒãŸã‚­ãƒ¼ã‚’GitHubã®SSH Keysã«è¿½åŠ 
```

#### è¿½åŠ ãƒ„ãƒ¼ãƒ«

```bash
# PM2ï¼ˆãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ï¼‰
npm install -g pm2

# nodemonï¼ˆé–‹ç™ºç”¨è‡ªå‹•å†èµ·å‹•ï¼‰
npm install -g nodemon

# SQLite3 CLI
sudo apt install -y sqlite3  # Linux
brew install sqlite3         # macOS
```

### 3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p ~/projects
cd ~/projects

# ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/denof-inc/sokubutsu2.git
cd sokubutsu2

# è»½é‡ç‰ˆãƒ–ãƒ©ãƒ³ãƒã«åˆ‡ã‚Šæ›¿ãˆ
git checkout lightweight-version

# ã¾ãŸã¯æ–°è¦ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b feature/your-feature-name
```

#### ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install

# è»½é‡ã‚½ã‚¯ãƒ–ãƒ„å°‚ç”¨ä¾å­˜é–¢ä¿‚
pnpm add axios cheerio jsdom tough-cookie user-agents better-sqlite3

# é–‹ç™ºä¾å­˜é–¢ä¿‚
pnpm add -D nodemon jest supertest @types/node @types/jest eslint prettier

# TypeScripté–¢é€£ï¼ˆTypeScriptä½¿ç”¨æ™‚ï¼‰
pnpm add -D typescript @types/axios @types/cheerio ts-node

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
pnpm list
```

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ

```bash
# å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p data cache logs temp scripts tests

# æ¨©é™è¨­å®š
chmod 755 data cache logs temp scripts tests
```

### 4. ç’°å¢ƒè¨­å®š

#### ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

```bash
# .env.development ä½œæˆ
cat > .env.development << 'EOF'
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
NODE_ENV=development
PORT=3000
LOG_LEVEL=debug

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
DATABASE_PATH=./data/sokubutsu_dev.db
CACHE_DIR=./cache/development

# Telegram Botè¨­å®šï¼ˆé–‹ç™ºç”¨ï¼‰
TELEGRAM_BOT_TOKEN=your_development_bot_token

# ç›£è¦–è¨­å®š
MONITORING_INTERVAL=60
MAX_CONCURRENT_CHECKS=3
REQUEST_TIMEOUT=10000

# Botå¯¾ç­–è¨­å®š
BOT_PROTECTION_ENABLED=true
USER_AGENT_ROTATION=true

# é–‹ç™ºç”¨è¨­å®š
DEBUG_MODE=true
VERBOSE_LOGGING=true
MOCK_TELEGRAM=true
MOCK_SCRAPING=false

# ãƒ†ã‚¹ãƒˆè¨­å®š
TEST_DATABASE_PATH=./data/sokubutsu_test.db
TEST_CACHE_DIR=./cache/test
EOF

# .env.test ä½œæˆ
cat > .env.test << 'EOF'
NODE_ENV=test
PORT=3001
LOG_LEVEL=error
DATABASE_PATH=./data/sokubutsu_test.db
CACHE_DIR=./cache/test
TELEGRAM_BOT_TOKEN=test_token
MONITORING_INTERVAL=10
MOCK_TELEGRAM=true
MOCK_SCRAPING=true
EOF

# æ¨©é™è¨­å®š
chmod 600 .env.development .env.test
```

#### package.json ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¨­å®š

```json
{
  "scripts": {
    "dev": "nodemon --env-file=.env.development src/main.js",
    "start": "node --env-file=.env.development src/main.js",
    "start:prod": "node --env-file=.env.production src/main.js",
    "test": "jest --env-file=.env.test",
    "test:watch": "jest --watch --env-file=.env.test",
    "test:coverage": "jest --coverage --env-file=.env.test",
    "lint": "eslint src/ --ext .js,.ts",
    "lint:fix": "eslint src/ --ext .js,.ts --fix",
    "format": "prettier --write src/",
    "db:init": "node scripts/init-database.js",
    "db:seed": "node scripts/seed-database.js",
    "db:reset": "node scripts/reset-database.js",
    "build": "echo 'No build step required for lightweight version'",
    "clean": "rm -rf data/*.db cache/* logs/* temp/*"
  }
}
```

### 5. VS Codeè¨­å®š

#### æ¨å¥¨æ‹¡å¼µæ©Ÿèƒ½

```bash
# VS Codeæ‹¡å¼µæ©Ÿèƒ½ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
code --install-extension ms-vscode.vscode-json
code --install-extension bradlc.vscode-tailwindcss
code --install-extension esbenp.prettier-vscode
code --install-extension ms-vscode.vscode-eslint
code --install-extension ms-vscode.vscode-typescript-next
code --install-extension ms-vscode-remote.remote-wsl  # WSLä½¿ç”¨æ™‚
code --install-extension alexcvzz.vscode-sqlite
code --install-extension humao.rest-client
```

#### VS Codeè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

```bash
# .vscode/settings.json ä½œæˆ
mkdir -p .vscode
cat > .vscode/settings.json << 'EOF'
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "files.exclude": {
    "**/node_modules": true,
    "**/data/*.db": false,
    "**/cache": true,
    "**/logs": true,
    "**/temp": true
  },
  "search.exclude": {
    "**/node_modules": true,
    "**/cache": true,
    "**/logs": true,
    "**/temp": true
  },
  "eslint.workingDirectories": ["src"],
  "typescript.preferences.importModuleSpecifier": "relative",
  "javascript.preferences.importModuleSpecifier": "relative"
}
EOF
```

#### ãƒ‡ãƒãƒƒã‚°è¨­å®š

```bash
# .vscode/launch.json ä½œæˆ
cat > .vscode/launch.json << 'EOF'
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch Lightweight Sokubutsu",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/src/main.js",
      "envFile": "${workspaceFolder}/.env.development",
      "console": "integratedTerminal",
      "restart": true,
      "runtimeArgs": ["--inspect"],
      "skipFiles": ["<node_internals>/**"]
    },
    {
      "name": "Debug Tests",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/jest",
      "args": ["--runInBand", "--no-cache"],
      "envFile": "${workspaceFolder}/.env.test",
      "console": "integratedTerminal",
      "internalConsoleOptions": "neverOpen"
    },
    {
      "name": "Debug Single Test",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/jest",
      "args": ["--runInBand", "--no-cache", "${fileBasenameNoExtension}"],
      "envFile": "${workspaceFolder}/.env.test",
      "console": "integratedTerminal",
      "internalConsoleOptions": "neverOpen"
    }
  ]
}
EOF
```

#### ã‚¿ã‚¹ã‚¯è¨­å®š

```bash
# .vscode/tasks.json ä½œæˆ
cat > .vscode/tasks.json << 'EOF'
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Start Development Server",
      "type": "shell",
      "command": "pnpm",
      "args": ["dev"],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Run Tests",
      "type": "shell",
      "command": "pnpm",
      "args": ["test"],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      }
    },
    {
      "label": "Initialize Database",
      "type": "shell",
      "command": "pnpm",
      "args": ["db:init"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      }
    },
    {
      "label": "Reset Database",
      "type": "shell",
      "command": "pnpm",
      "args": ["db:reset"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      }
    },
    {
      "label": "Lint and Fix",
      "type": "shell",
      "command": "pnpm",
      "args": ["lint:fix"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      }
    }
  ]
}
EOF
```

### 6. å“è³ªç®¡ç†è¨­å®š

#### ESLintè¨­å®š

```bash
# .eslintrc.js ä½œæˆ
cat > .eslintrc.js << 'EOF'
module.exports = {
  env: {
    node: true,
    es2022: true,
    jest: true
  },
  extends: [
    'eslint:recommended'
  ],
  parserOptions: {
    ecmaVersion: 2022,
    sourceType: 'module'
  },
  rules: {
    'no-console': 'warn',
    'no-unused-vars': ['error', { 'argsIgnorePattern': '^_' }],
    'no-var': 'error',
    'prefer-const': 'error',
    'eqeqeq': 'error',
    'curly': 'error',
    'brace-style': ['error', '1tbs'],
    'comma-dangle': ['error', 'never'],
    'quotes': ['error', 'single'],
    'semi': ['error', 'always'],
    'indent': ['error', 2],
    'linebreak-style': ['error', 'unix'],
    'max-len': ['warn', { 'code': 100 }],
    'no-trailing-spaces': 'error',
    'eol-last': 'error'
  },
  overrides: [
    {
      files: ['tests/**/*.js', '**/*.test.js', '**/*.spec.js'],
      rules: {
        'no-console': 'off'
      }
    }
  ]
};
EOF
```

#### Prettierè¨­å®š

```bash
# .prettierrc ä½œæˆ
cat > .prettierrc << 'EOF'
{
  "semi": true,
  "trailingComma": "none",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "endOfLine": "lf"
}
EOF

# .prettierignore ä½œæˆ
cat > .prettierignore << 'EOF'
node_modules/
data/
cache/
logs/
temp/
*.db
*.log
.env*
EOF
```

#### Jestè¨­å®š

```bash
# jest.config.js ä½œæˆ
cat > jest.config.js << 'EOF'
module.exports = {
  testEnvironment: 'node',
  roots: ['<rootDir>/src', '<rootDir>/tests'],
  testMatch: [
    '**/__tests__/**/*.js',
    '**/?(*.)+(spec|test).js'
  ],
  collectCoverageFrom: [
    'src/**/*.js',
    '!src/main.js',
    '!src/**/*.test.js',
    '!src/**/*.spec.js'
  ],
  coverageDirectory: 'coverage',
  coverageReporters: ['text', 'lcov', 'html'],
  setupFilesAfterEnv: ['<rootDir>/tests/setup.js'],
  testTimeout: 30000,
  verbose: true,
  forceExit: true,
  clearMocks: true,
  resetMocks: true,
  restoreMocks: true
};
EOF
```

### 7. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–

#### åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

```bash
# scripts/init-database.js ä½œæˆ
mkdir -p scripts
cat > scripts/init-database.js << 'EOF'
const Database = require('better-sqlite3');
const path = require('path');
const fs = require('fs');

const dbPath = process.env.DATABASE_PATH || './data/sokubutsu_dev.db';
const dbDir = path.dirname(dbPath);

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
if (!fs.existsSync(dbDir)) {
  fs.mkdirSync(dbDir, { recursive: true });
}

console.log(`Initializing database: ${dbPath}`);

const db = new Database(dbPath);

// WALãƒ¢ãƒ¼ãƒ‰è¨­å®š
db.pragma('journal_mode = WAL');
db.pragma('synchronous = NORMAL');
db.pragma('cache_size = -64000');
db.pragma('temp_store = MEMORY');

// ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆSQL
const createTablesSQL = `
  CREATE TABLE IF NOT EXISTS users (
    id TEXT PRIMARY KEY,
    username TEXT,
    first_name TEXT,
    last_name TEXT,
    language_code TEXT DEFAULT 'ja',
    is_active BOOLEAN DEFAULT true,
    url_limit INTEGER DEFAULT 3,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_active_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );

  CREATE TABLE IF NOT EXISTS urls (
    id TEXT PRIMARY KEY,
    url TEXT NOT NULL,
    name TEXT NOT NULL,
    user_id TEXT NOT NULL,
    interval INTEGER DEFAULT 300,
    enabled BOOLEAN DEFAULT true,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_checked DATETIME,
    status TEXT DEFAULT 'pending',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
  );

  CREATE TABLE IF NOT EXISTS monitoring_logs (
    id TEXT PRIMARY KEY,
    url_id TEXT NOT NULL,
    checked_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    new_count INTEGER DEFAULT 0,
    has_new BOOLEAN DEFAULT false,
    method TEXT NOT NULL,
    response_time INTEGER,
    status_code INTEGER,
    bot_protection BOOLEAN DEFAULT false,
    memory_usage REAL,
    error TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (url_id) REFERENCES urls(id) ON DELETE CASCADE
  );

  CREATE TABLE IF NOT EXISTS notifications (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL,
    url_id TEXT,
    type TEXT NOT NULL,
    title TEXT NOT NULL,
    message TEXT NOT NULL,
    sent_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    delivered BOOLEAN DEFAULT false,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (url_id) REFERENCES urls(id) ON DELETE SET NULL
  );

  CREATE TABLE IF NOT EXISTS sessions (
    id TEXT PRIMARY KEY,
    domain TEXT NOT NULL,
    user_agent TEXT NOT NULL,
    cookies TEXT,
    last_access DATETIME DEFAULT CURRENT_TIMESTAMP,
    expires_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );
`;

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆSQL
const createIndexesSQL = `
  CREATE INDEX IF NOT EXISTS idx_users_active ON users(is_active);
  CREATE INDEX IF NOT EXISTS idx_users_last_active ON users(last_active_at);
  
  CREATE INDEX IF NOT EXISTS idx_urls_user_id ON urls(user_id);
  CREATE INDEX IF NOT EXISTS idx_urls_enabled ON urls(enabled);
  CREATE INDEX IF NOT EXISTS idx_urls_status ON urls(status);
  CREATE INDEX IF NOT EXISTS idx_urls_last_checked ON urls(last_checked);
  CREATE UNIQUE INDEX IF NOT EXISTS idx_urls_user_url ON urls(user_id, url);
  
  CREATE INDEX IF NOT EXISTS idx_logs_url_id ON monitoring_logs(url_id);
  CREATE INDEX IF NOT EXISTS idx_logs_checked_at ON monitoring_logs(checked_at);
  CREATE INDEX IF NOT EXISTS idx_logs_has_new ON monitoring_logs(has_new);
  CREATE INDEX IF NOT EXISTS idx_logs_method ON monitoring_logs(method);
  
  CREATE INDEX IF NOT EXISTS idx_notifications_user_id ON notifications(user_id);
  CREATE INDEX IF NOT EXISTS idx_notifications_type ON notifications(type);
  CREATE INDEX IF NOT EXISTS idx_notifications_sent_at ON notifications(sent_at);
  CREATE INDEX IF NOT EXISTS idx_notifications_delivered ON notifications(delivered);
  
  CREATE INDEX IF NOT EXISTS idx_sessions_domain ON sessions(domain);
  CREATE INDEX IF NOT EXISTS idx_sessions_expires_at ON sessions(expires_at);
  CREATE UNIQUE INDEX IF NOT EXISTS idx_sessions_domain_ua ON sessions(domain, user_agent);
`;

try {
  // ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
  db.exec(createTablesSQL);
  console.log('âœ… Tables created successfully');

  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
  db.exec(createIndexesSQL);
  console.log('âœ… Indexes created successfully');

  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±è¡¨ç¤º
  const tables = db.prepare("SELECT name FROM sqlite_master WHERE type='table'").all();
  console.log('ğŸ“Š Created tables:', tables.map(t => t.name).join(', '));

  console.log('ğŸ‰ Database initialization completed successfully');
} catch (error) {
  console.error('âŒ Database initialization failed:', error);
  process.exit(1);
} finally {
  db.close();
}
EOF
```

#### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# scripts/seed-database.js ä½œæˆ
cat > scripts/seed-database.js << 'EOF'
const Database = require('better-sqlite3');
const { v4: uuidv4 } = require('uuid');

const dbPath = process.env.DATABASE_PATH || './data/sokubutsu_dev.db';
console.log(`Seeding database: ${dbPath}`);

const db = new Database(dbPath);

// ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
const insertUser = db.prepare(`
  INSERT OR REPLACE INTO users (id, username, first_name, last_name, language_code, is_active, url_limit)
  VALUES (?, ?, ?, ?, ?, ?, ?)
`);

// ãƒ†ã‚¹ãƒˆURLä½œæˆ
const insertUrl = db.prepare(`
  INSERT OR REPLACE INTO urls (id, url, name, user_id, interval, enabled, status)
  VALUES (?, ?, ?, ?, ?, ?, ?)
`);

try {
  // ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼
  const testUsers = [
    {
      id: 'test_user_1',
      username: 'testuser1',
      first_name: 'ãƒ†ã‚¹ãƒˆ',
      last_name: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼1',
      language_code: 'ja',
      is_active: true,
      url_limit: 5
    },
    {
      id: 'test_user_2',
      username: 'testuser2',
      first_name: 'ãƒ†ã‚¹ãƒˆ',
      last_name: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼2',
      language_code: 'ja',
      is_active: true,
      url_limit: 3
    }
  ];

  // ãƒ†ã‚¹ãƒˆURL
  const testUrls = [
    {
      id: uuidv4(),
      url: 'https://suumo.jp/jj/chintai/ichiran/FR301FC001/?ar=030&bs=040',
      name: 'æ¸‹è°·ã‚¨ãƒªã‚¢ãƒ»1K',
      user_id: 'test_user_1',
      interval: 300,
      enabled: true,
      status: 'active'
    },
    {
      id: uuidv4(),
      url: 'https://suumo.jp/jj/chintai/ichiran/FR301FC001/?ar=030&bs=050',
      name: 'æ¸‹è°·ã‚¨ãƒªã‚¢ãƒ»1DK',
      user_id: 'test_user_1',
      interval: 600,
      enabled: true,
      status: 'active'
    },
    {
      id: uuidv4(),
      url: 'https://suumo.jp/jj/chintai/ichiran/FR301FC001/?ar=040&bs=040',
      name: 'æ–°å®¿ã‚¨ãƒªã‚¢ãƒ»1K',
      user_id: 'test_user_2',
      interval: 300,
      enabled: false,
      status: 'disabled'
    }
  ];

  // ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥
  const transaction = db.transaction(() => {
    for (const user of testUsers) {
      insertUser.run(user.id, user.username, user.first_name, user.last_name, 
                    user.language_code, user.is_active, user.url_limit);
    }

    for (const url of testUrls) {
      insertUrl.run(url.id, url.url, url.name, url.user_id, 
                   url.interval, url.enabled, url.status);
    }
  });

  transaction();

  console.log('âœ… Test data seeded successfully');
  console.log(`ğŸ“Š Created ${testUsers.length} users and ${testUrls.length} URLs`);

} catch (error) {
  console.error('âŒ Database seeding failed:', error);
  process.exit(1);
} finally {
  db.close();
}
EOF
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# scripts/reset-database.js ä½œæˆ
cat > scripts/reset-database.js << 'EOF'
const fs = require('fs');
const path = require('path');

const dbPath = process.env.DATABASE_PATH || './data/sokubutsu_dev.db';
const cacheDir = process.env.CACHE_DIR || './cache/development';

console.log('ğŸ—‘ï¸  Resetting database and cache...');

try {
  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
  if (fs.existsSync(dbPath)) {
    fs.unlinkSync(dbPath);
    console.log(`âœ… Deleted database: ${dbPath}`);
  }

  // WALãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
  const walPath = dbPath + '-wal';
  if (fs.existsSync(walPath)) {
    fs.unlinkSync(walPath);
    console.log(`âœ… Deleted WAL file: ${walPath}`);
  }

  // SHMãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
  const shmPath = dbPath + '-shm';
  if (fs.existsSync(shmPath)) {
    fs.unlinkSync(shmPath);
    console.log(`âœ… Deleted SHM file: ${shmPath}`);
  }

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¯ãƒªã‚¢
  if (fs.existsSync(cacheDir)) {
    const files = fs.readdirSync(cacheDir);
    for (const file of files) {
      const filePath = path.join(cacheDir, file);
      if (fs.statSync(filePath).isFile()) {
        fs.unlinkSync(filePath);
      }
    }
    console.log(`âœ… Cleared cache directory: ${cacheDir}`);
  }

  console.log('ğŸ‰ Database and cache reset completed');
  console.log('ğŸ’¡ Run "pnpm db:init" to initialize a fresh database');

} catch (error) {
  console.error('âŒ Reset failed:', error);
  process.exit(1);
}
EOF
```

### 8. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

#### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–
pnpm db:init

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
pnpm db:seed

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pnpm dev
```

#### å‹•ä½œç¢ºèª

```bash
# åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:3000/health

# æœŸå¾…ã•ã‚Œã‚‹å¿œç­”
{
  "status": "ok",
  "timestamp": "2024-01-26T10:30:00.000Z",
  "uptime": 1.234,
  "memory": {
    "used": 25.6,
    "total": 100.0
  },
  "database": "connected"
}
```

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 1. æ©Ÿèƒ½é–‹ç™ºã®æµã‚Œ

#### ãƒ–ãƒ©ãƒ³ãƒä½œæˆ

```bash
# æœ€æ–°ã®mainãƒ–ãƒ©ãƒ³ãƒã‚’å–å¾—
git checkout main
git pull origin main

# æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b feature/new-feature-name

# ã¾ãŸã¯ä¿®æ­£ãƒ–ãƒ©ãƒ³ãƒ
git checkout -b fix/bug-description
```

#### é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«

```bash
# 1. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pnpm dev

# 2. ã‚³ãƒ¼ãƒ‰å¤‰æ›´
# VS Codeã§ç·¨é›†ã€nodemonãŒè‡ªå‹•å†èµ·å‹•

# 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test

# 4. ãƒªãƒ³ãƒˆãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
pnpm lint:fix
pnpm format

# 5. ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "feat: add new feature"

# 6. ãƒ—ãƒƒã‚·ãƒ¥
git push origin feature/new-feature-name
```

#### ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ

```bash
# GitHub CLIã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
gh pr create --title "Add new feature" --body "Description of changes"

# ã¾ãŸã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§GitHubã«ã‚¢ã‚¯ã‚»ã‚¹
```

### 2. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

#### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```bash
# ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
tests/
â”œâ”€â”€ setup.js                 # ãƒ†ã‚¹ãƒˆå…±é€šè¨­å®š
â”œâ”€â”€ unit/                     # å˜ä½“ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ scraping.test.js
â”‚   â”‚   â”œâ”€â”€ database.test.js
â”‚   â”‚   â””â”€â”€ telegram.test.js
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ bot-protection.test.js
â”‚       â””â”€â”€ cache.test.js
â”œâ”€â”€ integration/              # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ api.test.js
â”‚   â””â”€â”€ monitoring.test.js
â””â”€â”€ e2e/                      # E2Eãƒ†ã‚¹ãƒˆ
    â””â”€â”€ full-workflow.test.js
```

#### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test

# ç›£è¦–ãƒ¢ãƒ¼ãƒ‰ï¼ˆé–‹ç™ºæ™‚ï¼‰
pnpm test:watch

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ã
pnpm test:coverage

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
pnpm test scraping.test.js

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
pnpm test --testNamePattern="should scrape new listings"
```

#### ãƒ†ã‚¹ãƒˆä¾‹

```javascript
// tests/unit/services/scraping.test.js
const ScrapingService = require('../../../src/services/scraping');

describe('ScrapingService', () => {
  let scrapingService;

  beforeEach(() => {
    scrapingService = new ScrapingService();
  });

  describe('checkNewListings', () => {
    test('should detect new listings', async () => {
      const url = 'https://suumo.jp/test-url';
      const result = await scrapingService.checkNewListings(url);

      expect(result).toHaveProperty('hasNew');
      expect(result).toHaveProperty('newCount');
      expect(result).toHaveProperty('method');
      expect(result.method).toMatch(/^(http-only|jsdom|playwright)$/);
    });

    test('should handle bot protection', async () => {
      const url = 'https://suumo.jp/protected-url';
      const result = await scrapingService.checkNewListings(url, {
        botProtection: true
      });

      expect(result.botProtection).toBe(true);
    });
  });
});
```

### 3. ãƒ‡ãƒãƒƒã‚°æ‰‹æ³•

#### VS Codeãƒ‡ãƒãƒƒã‚¬ãƒ¼ä½¿ç”¨

```bash
# 1. ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨­å®š
# VS Codeã§ã‚³ãƒ¼ãƒ‰ã®è¡Œç•ªå·å·¦ã‚’ã‚¯ãƒªãƒƒã‚¯

# 2. ãƒ‡ãƒãƒƒã‚°é–‹å§‹
# F5ã‚­ãƒ¼ã¾ãŸã¯ã€Œå®Ÿè¡Œã¨ãƒ‡ãƒãƒƒã‚°ã€ãƒ‘ãƒãƒ«ã‹ã‚‰ã€ŒLaunch Lightweight Sokubutsuã€ã‚’é¸æŠ

# 3. ãƒ‡ãƒãƒƒã‚°æ“ä½œ
# F10: ã‚¹ãƒ†ãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼
# F11: ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³
# Shift+F11: ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ã‚¦ãƒˆ
# F5: ç¶šè¡Œ
```

#### ãƒ­ã‚°ãƒ™ãƒ¼ã‚¹ãƒ‡ãƒãƒƒã‚°

```javascript
// src/utils/logger.js
const logger = {
  debug: (message, data) => {
    if (process.env.DEBUG_MODE === 'true') {
      console.log(`[DEBUG] ${message}`, data || '');
    }
  },
  info: (message, data) => {
    console.log(`[INFO] ${message}`, data || '');
  },
  warn: (message, data) => {
    console.warn(`[WARN] ${message}`, data || '');
  },
  error: (message, error) => {
    console.error(`[ERROR] ${message}`, error);
  }
};

module.exports = logger;
```

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š

```javascript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šä¾‹
const performanceMonitor = {
  start: (label) => {
    console.time(label);
    const startMemory = process.memoryUsage();
    return { label, startMemory, startTime: Date.now() };
  },
  
  end: (monitor) => {
    console.timeEnd(monitor.label);
    const endMemory = process.memoryUsage();
    const duration = Date.now() - monitor.startTime;
    
    console.log(`Memory usage for ${monitor.label}:`, {
      heapUsed: `${Math.round((endMemory.heapUsed - monitor.startMemory.heapUsed) / 1024 / 1024 * 100) / 100} MB`,
      duration: `${duration}ms`
    });
  }
};

// ä½¿ç”¨ä¾‹
const monitor = performanceMonitor.start('scraping-operation');
await scrapingService.checkNewListings(url);
performanceMonitor.end(monitor);
```

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†

#### é–‹ç™ºç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ

```bash
# SQLite CLIæ¥ç¶š
sqlite3 data/sokubutsu_dev.db

# ã‚ˆãä½¿ç”¨ã™ã‚‹ã‚¯ã‚¨ãƒª
.tables                              # ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
.schema users                        # ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ç¢ºèª
SELECT COUNT(*) FROM users;          # ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ç¢ºèª
SELECT * FROM urls WHERE enabled=1;  # æœ‰åŠ¹ãªURLä¸€è¦§
.quit                                # çµ‚äº†
```

#### DBeaverä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

```bash
# DBeaver Community Edition ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# https://dbeaver.io/download/

# æ¥ç¶šè¨­å®š
# Database: SQLite
# Path: /path/to/sokubutsu2/data/sokubutsu_dev.db
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
// scripts/migrate.js
const Database = require('better-sqlite3');

const migrations = [
  {
    version: 1,
    description: 'Add sessions table',
    sql: `
      CREATE TABLE IF NOT EXISTS sessions (
        id TEXT PRIMARY KEY,
        domain TEXT NOT NULL,
        user_agent TEXT NOT NULL,
        cookies TEXT,
        last_access DATETIME DEFAULT CURRENT_TIMESTAMP,
        expires_at DATETIME,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
      );
    `
  }
  // æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã“ã“ã«è¿½åŠ 
];

function runMigrations() {
  const db = new Database(process.env.DATABASE_PATH || './data/sokubutsu_dev.db');
  
  // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
  db.exec(`
    CREATE TABLE IF NOT EXISTS migrations (
      version INTEGER PRIMARY KEY,
      description TEXT,
      applied_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )
  `);
  
  // é©ç”¨æ¸ˆã¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª
  const appliedMigrations = db.prepare('SELECT version FROM migrations').all();
  const appliedVersions = appliedMigrations.map(m => m.version);
  
  // æœªé©ç”¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
  for (const migration of migrations) {
    if (!appliedVersions.includes(migration.version)) {
      console.log(`Applying migration ${migration.version}: ${migration.description}`);
      
      try {
        db.exec(migration.sql);
        db.prepare('INSERT INTO migrations (version, description) VALUES (?, ?)')
          .run(migration.version, migration.description);
        
        console.log(`âœ… Migration ${migration.version} applied successfully`);
      } catch (error) {
        console.error(`âŒ Migration ${migration.version} failed:`, error);
        break;
      }
    }
  }
  
  db.close();
}

if (require.main === module) {
  runMigrations();
}

module.exports = { runMigrations };
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ä¸€èˆ¬çš„ãªå•é¡Œã¨è§£æ±ºç­–

#### Node.jsé–¢é€£

```bash
# Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
node --version

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„å ´åˆ
# Ubuntu/WSL2
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# macOS
brew upgrade node@20

# pnpmé–¢é€£å•é¡Œ
npm install -g pnpm@latest
pnpm store prune
```

#### ä¾å­˜é–¢ä¿‚å•é¡Œ

```bash
# node_moduleså‰Šé™¤ãƒ»å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules pnpm-lock.yaml
pnpm install

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
pnpm store prune
npm cache clean --force

# ç‰¹å®šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å•é¡Œ
pnpm remove problematic-package
pnpm add problematic-package
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å•é¡Œ

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™ç¢ºèª
ls -la data/sokubutsu_dev.db

# æ¨©é™ä¿®æ­£
chmod 600 data/sokubutsu_dev.db

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç ´ææ™‚
pnpm db:reset
pnpm db:init
pnpm db:seed
```

#### ãƒãƒ¼ãƒˆç«¶åˆ

```bash
# ãƒãƒ¼ãƒˆä½¿ç”¨çŠ¶æ³ç¢ºèª
lsof -i :3000
netstat -tulpn | grep :3000

# ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†
kill -9 <PID>

# åˆ¥ãƒãƒ¼ãƒˆä½¿ç”¨
PORT=3001 pnpm dev
```

#### ãƒ¡ãƒ¢ãƒªä¸è¶³

```bash
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèª
free -h
ps aux --sort=-%mem | head

# Node.jsãƒ¡ãƒ¢ãƒªåˆ¶é™è¨­å®š
export NODE_OPTIONS="--max-old-space-size=512"
pnpm dev

# ã‚¹ãƒ¯ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆï¼ˆLinuxï¼‰
sudo fallocate -l 1G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

### VS Codeé–¢é€£å•é¡Œ

#### æ‹¡å¼µæ©Ÿèƒ½å•é¡Œ

```bash
# æ‹¡å¼µæ©Ÿèƒ½ãƒªã‚»ãƒƒãƒˆ
code --disable-extensions
code --list-extensions
code --uninstall-extension <extension-id>
```

#### WSL2é–¢é€£å•é¡Œ

```bash
# WSL2å†èµ·å‹•
wsl --shutdown
wsl

# VS Code Serverå†èµ·å‹•
# Ctrl+Shift+P â†’ "Remote-WSL: Restart WSL"

# ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–åˆ¶é™å¢—åŠ 
echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### é–‹ç™ºç’°å¢ƒæœ€é©åŒ–

#### Node.jsæœ€é©åŒ–

```bash
# .bashrc ã¾ãŸã¯ .zshrc ã«è¿½åŠ 
export NODE_OPTIONS="--max-old-space-size=512 --optimize-for-size"
export UV_THREADPOOL_SIZE=4

# é–‹ç™ºç”¨æœ€é©åŒ–
export NODE_ENV=development
export DEBUG_MODE=true
```

#### ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–æœ€é©åŒ–

```bash
# nodemonè¨­å®šæœ€é©åŒ–
# nodemon.json ä½œæˆ
cat > nodemon.json << 'EOF'
{
  "watch": ["src/"],
  "ext": "js,json",
  "ignore": ["src/**/*.test.js", "src/**/*.spec.js"],
  "delay": 1000,
  "env": {
    "NODE_ENV": "development"
  },
  "verbose": false
}
EOF
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

```javascript
// é–‹ç™ºç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
const Database = require('better-sqlite3');

const db = new Database(dbPath, {
  pragma: {
    journal_mode: 'WAL',
    synchronous: 'NORMAL',
    cache_size: -32000,      // 32MBï¼ˆé–‹ç™ºç”¨ï¼‰
    temp_store: 'MEMORY',
    mmap_size: 134217728     // 128MBï¼ˆé–‹ç™ºç”¨ï¼‰
  }
});
```

### ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Š

#### è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®š

```bash
# Git Hooksè¨­å®š
npx husky install
npx husky add .husky/pre-commit "pnpm lint:fix && pnpm format"
npx husky add .husky/pre-push "pnpm test"
```

#### ã‚³ãƒ¼ãƒ‰åˆ†æ

```bash
# è¤‡é›‘åº¦åˆ†æ
npm install -g complexity-report
cr --format json src/ > complexity-report.json

# ä¾å­˜é–¢ä¿‚åˆ†æ
npm install -g madge
madge --circular src/
madge --image dependency-graph.svg src/
```

## ãƒãƒ¼ãƒ é–‹ç™º

### Git ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

#### ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥

```bash
# ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒ
main                    # æœ¬ç•ªç’°å¢ƒ
develop                 # é–‹ç™ºçµ±åˆãƒ–ãƒ©ãƒ³ãƒ
lightweight-version     # è»½é‡ç‰ˆé–‹ç™ºãƒ–ãƒ©ãƒ³ãƒ

# æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒ
feature/feature-name    # æ–°æ©Ÿèƒ½é–‹ç™º
fix/bug-description     # ãƒã‚°ä¿®æ­£
hotfix/urgent-fix       # ç·Šæ€¥ä¿®æ­£
```

#### ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´„

```bash
# å½¢å¼: type(scope): description

# ä¾‹
feat(scraping): add bot protection mechanism
fix(database): resolve connection pool leak
docs(api): update endpoint documentation
test(monitoring): add integration tests
refactor(utils): optimize cache implementation
style(lint): fix eslint warnings
chore(deps): update dependencies
```

### ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼

#### ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

**æ©Ÿèƒ½æ€§**:
- [ ] è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡ã‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å•é¡ŒãŒãªã„ã‹

**ã‚³ãƒ¼ãƒ‰å“è³ª**:
- [ ] å¯èª­æ€§ãŒé«˜ã„ã‹
- [ ] é©åˆ‡ãªå‘½åãŒã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] é‡è¤‡ã‚³ãƒ¼ãƒ‰ãŒãªã„ã‹

**ãƒ†ã‚¹ãƒˆ**:
- [ ] é©åˆ‡ãªãƒ†ã‚¹ãƒˆãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒååˆ†ã‹
- [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãŒè€ƒæ…®ã•ã‚Œã¦ã„ã‚‹ã‹

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**:
- [ ] å…¥åŠ›å€¤æ¤œè¨¼ãŒé©åˆ‡ã‹
- [ ] æ©Ÿå¯†æƒ…å ±ãŒæ¼æ´©ã—ã¦ã„ãªã„ã‹
- [ ] èªè¨¼ãƒ»èªå¯ãŒé©åˆ‡ã‹

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†

#### READMEæ›´æ–°

```markdown
# è»½é‡ã‚½ã‚¯ãƒ–ãƒ„

ç‰©ä»¶æ–°ç€ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ï¼ˆè»½é‡ç‰ˆï¼‰

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

\`\`\`bash
git clone https://github.com/denof-inc/sokubutsu2.git
cd sokubutsu2
git checkout lightweight-version
pnpm install
pnpm db:init
pnpm dev
\`\`\`

## é–‹ç™ºç’°å¢ƒ

- Node.js 20.18.0+
- pnpm 8.0.0+
- SQLite 3.35+

è©³ç´°ã¯ [DEVELOPMENT.md](docs/DEVELOPMENT.md) ã‚’å‚ç…§
```

#### API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

```bash
# API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆ
npm install -g @apidevtools/swagger-jsdoc swagger-ui-express

# JSDocå½¢å¼ã§ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°
/**
 * @swagger
 * /api/urls:
 *   get:
 *     summary: Get user URLs
 *     parameters:
 *       - in: query
 *         name: userId
 *         required: true
 *         schema:
 *           type: string
 *     responses:
 *       200:
 *         description: Success
 */
```

## ã¾ã¨ã‚

è»½é‡ã‚½ã‚¯ãƒ–ãƒ„ã®é–‹ç™ºç’°å¢ƒã¯ã€è‡ªå®…ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒã§ã®ç‰©ä»¶ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã«æœ€é©åŒ–ã•ã‚ŒãŸåŒ…æ‹¬çš„ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

### ä¸»è¦ãªç‰¹å¾´

1. **è»½é‡è¨­è¨ˆ**: ãƒ¡ãƒ¢ãƒª20-40MBã€èµ·å‹•æ™‚é–“1-2ç§’ã®é«˜é€Ÿé–‹ç™ºç’°å¢ƒ
2. **çµ±åˆé–‹ç™ºç’°å¢ƒ**: VS Code + ãƒ‡ãƒãƒƒã‚¬ãƒ¼ + è‡ªå‹•ãƒ†ã‚¹ãƒˆ
3. **å“è³ªç®¡ç†**: ESLint + Prettier + Jest ã«ã‚ˆã‚‹å“è³ªä¿è¨¼
4. **åŠ¹ç‡çš„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: è‡ªå‹•åŒ–ã•ã‚ŒãŸé–‹ç™ºã‚µã‚¤ã‚¯ãƒ«
5. **åŒ…æ‹¬çš„ãƒ„ãƒ¼ãƒ«**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç† + ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

### æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

- **é–‹ç™ºåŠ¹ç‡**: 50%å‘ä¸Šï¼ˆè‡ªå‹•åŒ– + é«˜é€Ÿèµ·å‹•ï¼‰
- **ã‚³ãƒ¼ãƒ‰å“è³ª**: å¤§å¹…å‘ä¸Šï¼ˆãƒªãƒ³ãƒˆ + ãƒ†ã‚¹ãƒˆï¼‰
- **ãƒãƒ¼ãƒ å”åŠ›**: çµ±ä¸€ã•ã‚ŒãŸé–‹ç™ºç’°å¢ƒ
- **ä¿å®ˆæ€§**: åŒ…æ‹¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ + ãƒ†ã‚¹ãƒˆ

### æŠ€è¡“çš„å„ªä½æ€§

1. **ãƒã‚¤ãƒ†ã‚£ãƒ–å®Ÿè¡Œ**: Dockerä¸è¦ã®è»½é‡ç’°å¢ƒ
2. **çµ±åˆãƒ„ãƒ¼ãƒ«**: é–‹ç™ºã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã®ä¸€è²«ã—ãŸãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³
3. **è‡ªå‹•åŒ–**: å“è³ªãƒã‚§ãƒƒã‚¯ + ãƒ†ã‚¹ãƒˆ + ãƒ‡ãƒ—ãƒ­ã‚¤ã®è‡ªå‹•åŒ–
4. **æ‹¡å¼µæ€§**: å°†æ¥ã®æ©Ÿèƒ½è¿½åŠ ã«å¯¾å¿œã—ãŸæŸ”è»Ÿãªè¨­è¨ˆ

ã“ã®åŒ…æ‹¬çš„ãªé–‹ç™ºç’°å¢ƒã«ã‚ˆã‚Šã€åŠ¹ç‡çš„ãªé–‹ç™ºã‚µã‚¤ã‚¯ãƒ«ã¨é«˜å“è³ªãªã‚³ãƒ¼ãƒ‰ä½œæˆã‚’å®Ÿç¾ã—ã€è»½é‡ã‚½ã‚¯ãƒ–ãƒ„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æˆåŠŸã‚’æ”¯æ´ã—ã¾ã™ã€‚

