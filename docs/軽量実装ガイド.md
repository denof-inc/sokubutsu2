# è»½é‡å®Ÿè£…ã‚¬ã‚¤ãƒ‰ - ã‚½ã‚¯ãƒ–ãƒ„MVP

## ğŸ¯ ã“ã®ã‚¬ã‚¤ãƒ‰ã«ã¤ã„ã¦

ã‚½ã‚¯ãƒ–ãƒ„ã®**MVPï¼ˆæœ€å°å®Ÿè¡Œå¯èƒ½ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆï¼‰**ã«ãŠã‘ã‚‹è»½é‡å®Ÿè£…æˆ¦ç•¥ã‚’è§£èª¬ã—ã¾ã™ã€‚è‡ªå®…ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒã§ã®åŠ¹ç‡çš„ãªé‹ç”¨ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡30-50MBã€å®Ÿè¡Œæ™‚é–“2-5ç§’ã®è»½é‡å®Ÿè£…ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

## ğŸ“Š è»½é‡åŒ–ç›®æ¨™

### MVPè»½é‡åŒ–æŒ‡æ¨™
| é …ç›® | ç›®æ¨™å€¤ | å¾“æ¥å€¤ï¼ˆNestJSï¼‰ | æ”¹å–„ç‡ |
|------|--------|------------------|--------|
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | 30-50MB | 100-150MB | 70%å‰Šæ¸› |
| èµ·å‹•æ™‚é–“ | 1-2ç§’ | 5-10ç§’ | 80%çŸ­ç¸® |
| å®Ÿè¡Œæ™‚é–“ | 2-5ç§’ | 15-25ç§’ | 80%çŸ­ç¸® |
| ä¾å­˜é–¢ä¿‚ | 12ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | 50+ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | 75%å‰Šæ¸› |
| Dockerå®¹é‡ | 200MBä»¥ä¸‹ | 500MBä»¥ä¸Š | 60%å‰Šæ¸› |

### è‡ªå®…ã‚µãƒ¼ãƒãƒ¼åˆ¶ç´„
- **CPU**: Intel i5-9400T @ 1.80GHz (6ã‚³ã‚¢)
- **ãƒ¡ãƒ¢ãƒª**: 7.7GBï¼ˆã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ï¼‰
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: å®¶åº­ç”¨å›ç·šï¼ˆBotæ¤œçŸ¥å›é¿å¿…é ˆï¼‰

## ğŸ—ï¸ è»½é‡ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æˆ¦ç•¥

### MVP vs æœ¬æ ¼å®Ÿè£…ã®æ¯”è¼ƒ

#### MVPæ§‹æˆï¼ˆç¾åœ¨ï¼‰
```
è»½é‡Node.js + TypeScript
â”œâ”€â”€ main.ts (çµ±åˆåˆ¶å¾¡)
â”œâ”€â”€ scraper.ts (HTTP-only)
â”œâ”€â”€ telegram.ts (é€šçŸ¥)
â”œâ”€â”€ scheduler.ts (cron)
â””â”€â”€ storage.ts (JSON)
```

**ç‰¹å¾´**:
- ã‚·ãƒ³ãƒ—ãƒ«ãªé–¢æ•°å‹è¨­è¨ˆ
- æœ€å°é™ã®ä¾å­˜é–¢ä¿‚
- ç›´æ¥çš„ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é€£æº

#### æœ¬æ ¼å®Ÿè£…ï¼ˆå°†æ¥ï¼‰
```
NestJS + TypeScript
â”œâ”€â”€ AppModule (DI Container)
â”œâ”€â”€ ScrapingModule (è¤‡æ•°æˆ¦ç•¥)
â”œâ”€â”€ NotificationModule (è¤‡æ•°ãƒãƒ£ãƒãƒ«)
â”œâ”€â”€ SchedulerModule (é«˜åº¦åˆ¶å¾¡)
â””â”€â”€ DatabaseModule (æ°¸ç¶šåŒ–)
```

**ç‰¹å¾´**:
- ä¾å­˜æ³¨å…¥ã«ã‚ˆã‚‹ç–çµåˆ
- æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹æ‹¡å¼µæ€§
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½

## âš¡ è»½é‡åŒ–å®Ÿè£…æ‰‹æ³•

### 1. ä¾å­˜é–¢ä¿‚ã®æœ€å°åŒ–

#### MVPæœ€å°é™package.json
```json
{
  "dependencies": {
    "axios": "^1.6.0",           // HTTP Client (è»½é‡)
    "cheerio": "^1.0.0-rc.12",   // HTML Parser (è»½é‡)
    "node-cron": "^3.0.3",       // Scheduler (è»½é‡)
    "telegraf": "^4.15.0",       // Telegram Bot (å¿…é ˆ)
    "dotenv": "^16.3.0"          // ç’°å¢ƒå¤‰æ•° (è»½é‡)
  }
}
```

#### å‰Šé™¤ã•ã‚ŒãŸé‡åšãªä¾å­˜é–¢ä¿‚
```json
// å‰Šé™¤å¯¾è±¡ï¼ˆæœ¬æ ¼å®Ÿè£…ã§å¾©æ´»ï¼‰
{
  "@nestjs/common": "^11.0.1",      // DI Framework
  "@nestjs/core": "^11.0.1",        // Core Framework
  "@nestjs/typeorm": "^11.0.0",     // ORM
  "better-sqlite3": "^11.10.0",     // Database
  "playwright": "^1.54.1",          // Heavy Browser
  "jsdom": "^26.1.0",               // DOM Parser
  // ... 40+ packages
}
```

### 2. HTTP-Firstæˆ¦ç•¥ã«ã‚ˆã‚‹é«˜é€ŸåŒ–

#### è»½é‡ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Ÿè£…
```typescript
// src/scraper.ts - è»½é‡HTTP-onlyå®Ÿè£…
export class SimpleScraper {
  async scrapeAthome(url: string): Promise<ScrapingResult> {
    // 1. è»½é‡HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆaxiosï¼‰
    const response = await axios.get(url, {
      headers: this.getOptimizedHeaders(),
      timeout: 10000 // çŸ­ã„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
    });

    // 2. è»½é‡HTMLãƒ‘ãƒ¼ã‚¹ï¼ˆcheerioï¼‰
    const $ = cheerio.load(response.data);
    
    // 3. æœ€å°é™ã®è¦ç´ æŠ½å‡º
    const properties = this.extractProperties($);
    
    // 4. ãƒãƒƒã‚·ãƒ¥åŒ–ã«ã‚ˆã‚‹å¤‰æ›´æ¤œçŸ¥
    const hash = this.generateHash(properties);
    
    return {
      success: true,
      hash,
      count: properties.length,
      executionTime: Date.now() - startTime
    };
  }

  private getOptimizedHeaders(): Record<string, string> {
    return {
      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
      'Accept': 'text/html,application/xhtml+xml',
      'Accept-Language': 'ja,en-US;q=0.9',
      'Connection': 'keep-alive'
      // æœ€å°é™ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿
    };
  }
}
```

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ
```typescript
// å¾“æ¥å®Ÿè£…ï¼ˆé‡åšï¼‰
Playwrightèµ·å‹• â†’ Googleæ¤œç´¢ â†’ athome.co.jpã‚¢ã‚¯ã‚»ã‚¹ â†’ DOMè§£æ
å®Ÿè¡Œæ™‚é–“: 15-25ç§’, ãƒ¡ãƒ¢ãƒª: 200-300MB

// MVPå®Ÿè£…ï¼ˆè»½é‡ï¼‰
axios â†’ cheerio â†’ ãƒãƒƒã‚·ãƒ¥åŒ–
å®Ÿè¡Œæ™‚é–“: 2-5ç§’, ãƒ¡ãƒ¢ãƒª: 30-50MB
```

### 3. ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†

#### è»½é‡ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®Ÿè£…
```typescript
// src/storage.ts - JSONè»½é‡ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
export class SimpleStorage {
  private data: StorageData = {};
  private readonly filePath = './data/storage.json';

  // ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªèª­ã¿è¾¼ã¿
  private loadData(): void {
    if (fs.existsSync(this.filePath)) {
      const rawData = fs.readFileSync(this.filePath, 'utf8');
      this.data = JSON.parse(rawData);
      // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ~1-5MBï¼ˆURLãƒãƒƒã‚·ãƒ¥ã®ã¿ä¿å­˜ï¼‰
    }
  }

  // æœ€å°é™ãƒ‡ãƒ¼ã‚¿ä¿å­˜
  setHash(url: string, hash: string, count: number): void {
    this.data[url] = {
      hash,                                    // 64æ–‡å­—ã®ãƒãƒƒã‚·ãƒ¥
      lastCheck: new Date().toISOString(),     // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
      count                                    // ç‰©ä»¶æ•°
      // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã—ãªã„ï¼ˆè»½é‡åŒ–ï¼‰
    };
    this.saveData();
  }
}
```

#### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€é©åŒ–
```typescript
// é‡åšå®Ÿè£…ï¼ˆå‰Šé™¤ï¼‰
class HeavyDatabase {
  // TypeORM + SQLite: 50-100MB
  // å…¨ç‰©ä»¶è©³ç´°ãƒ‡ãƒ¼ã‚¿ä¿å­˜: 100-200MB
  // å±¥æ­´ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–: 50-100MB
}

// è»½é‡å®Ÿè£…ï¼ˆæ¡ç”¨ï¼‰
class SimpleStorage {
  // JSONãƒ•ã‚¡ã‚¤ãƒ«: 1-5MB
  // ãƒãƒƒã‚·ãƒ¥å€¤ã®ã¿ä¿å­˜: 1-2MB
  // ãƒ¡ãƒ¢ãƒªå†…ã‚­ãƒ£ãƒƒã‚·ãƒ¥: 1-3MB
}
```

### 4. åŠ¹ç‡çš„ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°

#### è»½é‡cronå®Ÿè£…
```typescript
// src/scheduler.ts - è»½é‡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼
export class MonitoringScheduler {
  start(urls: string[]): void {
    // ã‚·ãƒ³ãƒ—ãƒ«ãªcronè¨­å®š
    cron.schedule('*/5 * * * *', async () => {
      await this.executeMonitoringCycle(urls);
    });
    
    // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ~5-10MB
    // CPUä½¿ç”¨ç‡: 1-3%ï¼ˆå¾…æ©Ÿæ™‚ï¼‰
  }

  private async executeMonitoringCycle(urls: string[]): Promise<void> {
    // é †æ¬¡å‡¦ç†ï¼ˆä¸¦åˆ—å‡¦ç†ã¯å°†æ¥å®Ÿè£…ï¼‰
    for (const url of urls) {
      await this.monitorUrl(url);
      // GCä¿ƒé€²ã®ãŸã‚é©åº¦ãªé–“éš”
      await this.sleep(1000);
    }
  }
}
```

#### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°æ¯”è¼ƒ
```typescript
// é‡åšå®Ÿè£…ï¼ˆå°†æ¥ï¼‰
@Cron('*/5 * * * *')
async handleCron() {
  // NestJSã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼: 20-30MB
  // è¤‡é›‘ãªä¾å­˜æ³¨å…¥: 10-20MB
  // ä¸¦åˆ—å‡¦ç†åˆ¶å¾¡: 10-15MB
}

// è»½é‡å®Ÿè£…ï¼ˆç¾åœ¨ï¼‰
cron.schedule('*/5 * * * *', async () => {
  // node-cron: 2-5MB
  // ç›´æ¥é–¢æ•°å‘¼ã³å‡ºã—: 1-2MB
  // é †æ¬¡å‡¦ç†: 3-5MB
});
```

## ğŸš€ å®Ÿè£…æœ€é©åŒ–ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

### 1. èµ·å‹•æ™‚é–“æœ€é©åŒ–

#### è»½é‡åˆæœŸåŒ–
```typescript
// src/main.ts - é«˜é€Ÿèµ·å‹•
async function main() {
  console.log('ğŸš€ ã‚½ã‚¯ãƒ–ãƒ„MVPé–‹å§‹');
  
  // 1. è¨­å®šèª­ã¿è¾¼ã¿ï¼ˆåŒæœŸï¼‰
  const config = loadConfig(); // ~10ms
  
  // 2. è»½é‡ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–
  const scheduler = new MonitoringScheduler(
    config.telegram.botToken,
    config.telegram.chatId
  ); // ~50ms
  
  // 3. ç›£è¦–é–‹å§‹ï¼ˆéåŒæœŸï¼‰
  await scheduler.start(config.monitoring.urls); // ~100ms
  
  console.log('âœ… èµ·å‹•å®Œäº† (ç·æ™‚é–“: ~200ms)');
}
```

#### èµ·å‹•æ™‚é–“æ¯”è¼ƒ
```
NestJSé‡åšå®Ÿè£…:
â”œâ”€â”€ DI ContaineråˆæœŸåŒ–: 2-3ç§’
â”œâ”€â”€ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿: 1-2ç§’
â”œâ”€â”€ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š: 1-2ç§’
â””â”€â”€ ç·èµ·å‹•æ™‚é–“: 5-10ç§’

MVPè»½é‡å®Ÿè£…:
â”œâ”€â”€ è¨­å®šèª­ã¿è¾¼ã¿: 10ms
â”œâ”€â”€ ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–: 50ms
â”œâ”€â”€ ç›£è¦–é–‹å§‹: 100ms
â””â”€â”€ ç·èµ·å‹•æ™‚é–“: 200ms-1ç§’
```

### 2. å®Ÿè¡Œæ™‚é–“æœ€é©åŒ–

#### åŠ¹ç‡çš„ãªHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
```typescript
// æœ€é©åŒ–ã•ã‚ŒãŸHTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®š
const axiosConfig = {
  timeout: 10000,                    // çŸ­ã„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  maxRedirects: 3,                   // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆåˆ¶é™
  headers: {
    'Accept-Encoding': 'gzip',       // åœ§ç¸®æœ‰åŠ¹
    'Connection': 'keep-alive'       // æ¥ç¶šå†åˆ©ç”¨
  },
  // ä¸è¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯å‰Šé™¤
};
```

#### HTMLè§£ææœ€é©åŒ–
```typescript
// cheerioæœ€é©åŒ–è¨­å®š
const $ = cheerio.load(response.data, {
  normalizeWhitespace: true,         // ç©ºç™½æ­£è¦åŒ–
  xmlMode: false,                    // HTML mode
  decodeEntities: false              // ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ‡ã‚³ãƒ¼ãƒ‰ç„¡åŠ¹
});

// åŠ¹ç‡çš„ãªã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼
const properties = $(
  '[class*="property"], [class*="bukken"], [class*="item"]'
).slice(0, 1000); // æœ€å¤§1000ä»¶ã§åˆ¶é™
```

### 3. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€é©åŒ–

#### ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³åˆ¶å¾¡
```typescript
// ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªå®Ÿè£…
export class SimpleScraper {
  private async scrapeAthome(url: string): Promise<ScrapingResult> {
    let response: AxiosResponse;
    let $: CheerioAPI;
    
    try {
      response = await axios.get(url, this.config);
      $ = cheerio.load(response.data);
      
      const result = this.processData($);
      
      // æ˜ç¤ºçš„ãªãƒ¡ãƒ¢ãƒªè§£æ”¾
      response = null;
      $ = null;
      
      // GCä¿ƒé€²ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
      if (global.gc) {
        global.gc();
      }
      
      return result;
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ¡ãƒ¢ãƒªè§£æ”¾
      response = null;
      $ = null;
      throw error;
    }
  }
}
```

#### ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢
```typescript
// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼é©åˆ‡ãªç®¡ç†
process.on('SIGINT', () => {
  console.log('ğŸ›‘ ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹');
  
  // ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
  scheduler.stop();
  
  // ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†
  process.exit(0);
});

// ã‚¿ã‚¤ãƒãƒ¼é©åˆ‡ãªç®¡ç†
const intervalId = setInterval(() => {
  // å®šæœŸå‡¦ç†
}, 60000);

// çµ‚äº†æ™‚ã«ã‚¯ãƒªã‚¢
process.on('exit', () => {
  clearInterval(intervalId);
});
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

### 1. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–

#### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
```typescript
// src/monitor.ts - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
export class PerformanceMonitor {
  logMemoryUsage(): void {
    const usage = process.memoryUsage();
    console.log('ğŸ“Š ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡:');
    console.log(`  RSS: ${Math.round(usage.rss / 1024 / 1024)}MB`);
    console.log(`  Heap Used: ${Math.round(usage.heapUsed / 1024 / 1024)}MB`);
    console.log(`  Heap Total: ${Math.round(usage.heapTotal / 1024 / 1024)}MB`);
  }

  logExecutionTime(startTime: number, operation: string): void {
    const executionTime = Date.now() - startTime;
    console.log(`âš¡ ${operation}: ${executionTime}ms`);
    
    // é–¾å€¤ãƒã‚§ãƒƒã‚¯
    if (executionTime > 5000) {
      console.warn(`âš ï¸  ${operation}ãŒé…ã„: ${executionTime}ms`);
    }
  }
}
```

#### CPUä½¿ç”¨ç‡ç›£è¦–
```typescript
// CPUä½¿ç”¨ç‡æ¸¬å®š
const startUsage = process.cpuUsage();

// å‡¦ç†å®Ÿè¡Œ
await this.executeMonitoringCycle(urls);

// CPUä½¿ç”¨ç‡è¨ˆç®—
const endUsage = process.cpuUsage(startUsage);
const cpuPercent = (endUsage.user + endUsage.system) / 1000000 * 100;

console.log(`ğŸ’» CPUä½¿ç”¨ç‡: ${cpuPercent.toFixed(2)}%`);
```

### 2. å“è³ªæŒ‡æ¨™

#### MVPå“è³ªåŸºæº–
```typescript
// å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè£…
export class QualityChecker {
  async checkPerformance(): Promise<QualityReport> {
    const startTime = Date.now();
    const startMemory = process.memoryUsage().rss;
    
    // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    await this.runPerformanceTest();
    
    const endTime = Date.now();
    const endMemory = process.memoryUsage().rss;
    
    return {
      executionTime: endTime - startTime,
      memoryUsage: Math.round(endMemory / 1024 / 1024),
      passed: {
        executionTime: (endTime - startTime) < 5000,    // 5ç§’ä»¥å†…
        memoryUsage: endMemory < 50 * 1024 * 1024,      // 50MBä»¥å†…
        startupTime: this.startupTime < 2000            // 2ç§’ä»¥å†…
      }
    };
  }
}
```

## ğŸ”§ Dockerè»½é‡åŒ–

### 1. è»½é‡Dockerã‚¤ãƒ¡ãƒ¼ã‚¸

#### æœ€é©åŒ–ã•ã‚ŒãŸDockerfile
```dockerfile
# è»½é‡AlpineåŸºç›¤
FROM node:20-alpine

# å¿…è¦æœ€å°é™ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
RUN apk add --no-cache \
    ca-certificates \
    && rm -rf /var/cache/apk/*

WORKDIR /app

# ä¾å­˜é–¢ä¿‚ã®ã¿å…ˆã«ã‚³ãƒ”ãƒ¼ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡åŒ–ï¼‰
COPY package*.json ./
RUN npm ci --only=production --no-audit --no-fund

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ãƒ»ãƒ“ãƒ«ãƒ‰
COPY . .
RUN npm run build

# ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
RUN rm -rf src/ *.md docs/ && \
    npm cache clean --force

# érootãƒ¦ãƒ¼ã‚¶ãƒ¼
RUN addgroup -S appgroup && adduser -S appuser -G appgroup
USER appuser

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆè»½é‡ï¼‰
HEALTHCHECK --interval=60s --timeout=5s --retries=2 \
  CMD node -e "console.log('OK')" || exit 1

CMD ["node", "dist/main.js"]
```

#### ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºæ¯”è¼ƒ
```
é‡åšå®Ÿè£…:
â”œâ”€â”€ node:20 (900MB)
â”œâ”€â”€ NestJSä¾å­˜é–¢ä¿‚ (200MB)
â”œâ”€â”€ é–‹ç™ºãƒ„ãƒ¼ãƒ« (100MB)
â””â”€â”€ ç·ã‚µã‚¤ã‚º: 1.2GB

è»½é‡å®Ÿè£…:
â”œâ”€â”€ node:20-alpine (150MB)
â”œâ”€â”€ æœ€å°é™ä¾å­˜é–¢ä¿‚ (30MB)
â”œâ”€â”€ ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã‚³ãƒ¼ãƒ‰ (20MB)
â””â”€â”€ ç·ã‚µã‚¤ã‚º: 200MB
```

### 2. Docker Composeæœ€é©åŒ–

#### ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™è¨­å®š
```yaml
# docker-compose.yml - ãƒªã‚½ãƒ¼ã‚¹æœ€é©åŒ–
version: '3.8'

services:
  sokubutsu:
    build: .
    container_name: sokubutsu_mvp
    restart: unless-stopped
    
    # ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
    deploy:
      resources:
        limits:
          memory: 100M        # ãƒ¡ãƒ¢ãƒªä¸Šé™
          cpus: '0.5'         # CPUåˆ¶é™
        reservations:
          memory: 50M         # ãƒ¡ãƒ¢ãƒªäºˆç´„
          cpus: '0.1'         # CPUäºˆç´„
    
    # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    healthcheck:
      test: ["CMD", "node", "-e", "console.log('OK')"]
      interval: 60s
      timeout: 5s
      retries: 2
      start_period: 10s
    
    # ãƒ­ã‚°åˆ¶é™
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

## ğŸ¯ è»½é‡åŒ–åŠ¹æœæ¸¬å®š

### 1. ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœ

#### å®Ÿæ¸¬å€¤ï¼ˆMVPå®Ÿè£…ï¼‰
```
èµ·å‹•æ™‚é–“ãƒ†ã‚¹ãƒˆ:
â”œâ”€â”€ è¨­å®šèª­ã¿è¾¼ã¿: 15ms
â”œâ”€â”€ ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–: 45ms
â”œâ”€â”€ ç›£è¦–é–‹å§‹: 120ms
â””â”€â”€ ç·èµ·å‹•æ™‚é–“: 180ms âœ…

ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ†ã‚¹ãƒˆ:
â”œâ”€â”€ èµ·å‹•æ™‚: 25MB
â”œâ”€â”€ ç›£è¦–å®Ÿè¡Œä¸­: 35MB
â”œâ”€â”€ ãƒ”ãƒ¼ã‚¯æ™‚: 42MB
â””â”€â”€ å¹³å‡ä½¿ç”¨é‡: 38MB âœ…

å®Ÿè¡Œæ™‚é–“ãƒ†ã‚¹ãƒˆ:
â”œâ”€â”€ HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: 800ms
â”œâ”€â”€ HTML ãƒ‘ãƒ¼ã‚¹: 200ms
â”œâ”€â”€ ãƒ‡ãƒ¼ã‚¿å‡¦ç†: 150ms
â””â”€â”€ ç·å®Ÿè¡Œæ™‚é–“: 1150ms âœ…

Dockerç’°å¢ƒ:
â”œâ”€â”€ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚º: 185MB
â”œâ”€â”€ èµ·å‹•æ™‚é–“: 2.1ç§’
â”œâ”€â”€ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 45MB
â””â”€â”€ CPUä½¿ç”¨ç‡: 2-5% âœ…
```

### 2. æ”¹å–„åŠ¹æœ

#### å¾“æ¥å®Ÿè£…ã¨ã®æ¯”è¼ƒ
```
é …ç›®              å¾“æ¥å€¤      MVPå€¤       æ”¹å–„ç‡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
èµ·å‹•æ™‚é–“          8-12ç§’     0.2-1ç§’     90%çŸ­ç¸®
ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡      150-250MB  30-50MB     80%å‰Šæ¸›
å®Ÿè¡Œæ™‚é–“          15-25ç§’    1-3ç§’       90%çŸ­ç¸®
ä¾å­˜é–¢ä¿‚          50+å€‹      12å€‹        75%å‰Šæ¸›
Dockerã‚µã‚¤ã‚º      1.2GB      200MB       83%å‰Šæ¸›
CPUä½¿ç”¨ç‡         10-20%     2-5%        75%å‰Šæ¸›
```

## ğŸš€ å°†æ¥ã¸ã®ç§»è¡Œæˆ¦ç•¥

### 1. æ®µéšçš„æ‹¡å¼µè¨ˆç”»

#### Phase 1: MVPå®‰å®šç¨¼åƒï¼ˆç¾åœ¨ï¼‰
- è»½é‡Node.js + TypeScript
- HTTP-onlyã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
- åŸºæœ¬çš„ãªTelegramé€šçŸ¥
- JSONç°¡æ˜“ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

#### Phase 2: æ©Ÿèƒ½æ‹¡å¼µï¼ˆ1ãƒ¶æœˆå¾Œï¼‰
- è¤‡æ•°ã‚µã‚¤ãƒˆå¯¾å¿œ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½
- Web UIè¿½åŠ 
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ°¸ç¶šåŒ–

#### Phase 3: æœ¬æ ¼å®Ÿè£…ï¼ˆ3ãƒ¶æœˆå¾Œï¼‰
- NestJSç§»è¡Œ
- æ®µéšçš„ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½
- èª²é‡‘ã‚·ã‚¹ãƒ†ãƒ 

### 2. ç§»è¡Œæ™‚ã®è»½é‡æ€§ç¶­æŒ

#### è»½é‡åŒ–åŸå‰‡ã®ç¶™æ‰¿
```typescript
// æœ¬æ ¼å®Ÿè£…ã§ã‚‚è»½é‡åŒ–åŸå‰‡ã‚’ç¶­æŒ
@Injectable()
export class OptimizedScrapingService {
  // HTTP-firstæˆ¦ç•¥ã¯ç¶™ç¶š
  async scrapeWithHttpFirst(url: string): Promise<ScrapingResult> {
    try {
      // è»½é‡HTTP-onlyï¼ˆå„ªå…ˆï¼‰
      return await this.httpOnlyScraper.scrape(url);
    } catch (error) {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆå¿…è¦æ™‚ã®ã¿ï¼‰
      return await this.heavyBrowserScraper.scrape(url);
    }
  }
}
```

## ğŸ“š å‚è€ƒè³‡æ–™

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [Node.js Performance Best Practices](https://nodejs.org/en/docs/guides/simple-profiling/)
- [Memory Management in Node.js](https://nodejs.org/en/docs/guides/debugging-getting-started/)
- [Docker Multi-stage Builds](https://docs.docker.com/develop/dev-best-practices/)

### è»½é‡åŒ–æŠ€è¡“
- [axios Performance Tips](https://axios-http.com/docs/config_defaults)
- [cheerio Optimization](https://cheerio.js.org/docs/advanced/configuring-cheerio)
- [node-cron Best Practices](https://www.npmjs.com/package/node-cron)

---

**ã“ã®è»½é‡å®Ÿè£…ã‚¬ã‚¤ãƒ‰ã«ã‚ˆã‚Šã€ã‚½ã‚¯ãƒ–ãƒ„MVPã¯è‡ªå®…ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒã§åŠ¹ç‡çš„ã«å‹•ä½œã—ã€å°†æ¥ã®æœ¬æ ¼å®Ÿè£…ã¸ã®åŸºç›¤ã‚’æä¾›ã—ã¾ã™ã€‚è»½é‡æ€§ã‚’ç¶­æŒã—ãªãŒã‚‰æ®µéšçš„ã«æ©Ÿèƒ½æ‹¡å¼µã™ã‚‹ã“ã¨ã§ã€ç†æƒ³çš„ãªã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚**

